(this["webpackJsonpregraph-demo"]=this["webpackJsonpregraph-demo"]||[]).push([[0],{134:function(e,t,n){e.exports=n(219)},143:function(e,t,n){},195:function(e,t,n){},196:function(e,t,n){},197:function(e,t,n){},198:function(e,t,n){},204:function(e,t,n){},205:function(e,t,n){},216:function(e,t,n){},217:function(e,t,n){},218:function(e,t,n){},219:function(e,t,n){"use strict";n.r(t);var r,o=n(0),i=n(3),a=n(24),c=n.n(a),s=n(51),l=n(12),u=n(14),d=n(6),f=n(2),m=n(72),v=n(10),p=n.n(v),g=n(225),h=n(4),y=n(58);!function(e){e.common="common"}(r||(r={}));var k,b=Object(y.a)({},r.common,"\u901a\u7528");!function(e){e.mainOutput="mainOutput",e.errorOutput="errorOutput"}(k||(k={}));var w;!function(e){e.rect="rect",e.rectRadius="rectRadius",e.circle="circle",e.diamond="diamond",e.polygon="polygon",e.ellipse="ellipse",e.star="star"}(w||(w={}));var E=[{type:r.common,key:w.rect,name:"RECT",width:100,height:100,icon:o.createElement("div",{style:{width:36,height:36,border:"2px solid #52619b"}}),disabled:!1},{type:r.common,key:w.rectRadius,name:"RECT-RADIU",width:100,height:100,icon:o.createElement("div",{style:{width:36,height:36,border:"2px solid #52619b",borderRadius:10}}),disabled:!1},{type:r.common,key:w.circle,name:"CIRCLE",width:100,height:100,icon:o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"72px",height:"40px"},o.createElement("circle",{cx:"36",cy:"20",r:"18",stroke:"#52619b",strokeWidth:"2",fill:"transparent"})),disabled:!1}],x=Object(y.a)({},r.common,E);var N;!function(e){e.configuration="configuration",e.copy="copy",e.delete="delete",e.parallelism="parallelism",e.outputType="outputType",e.mainOutput="mainOutput",e.errorOutput="errorOutput",e.dataMethod="dataMethod",e.copyMethod="copyMethod",e.distribute="distribute",e.paste="paste",e.deleteLink="deleteLink",e.selectAll="selectAll",e.dragSelect="dragSelect"}(N||(N={}));n(143);var L=o.useState,S=(o.useEffect,g.a.Panel);function C(e){var t=Object.values(r),n=e.onDrag,i=e.visible,a=void 0!==i&&i,c=L([t[0]]),s=Object(d.a)(c,2),l=s[0],u=s[1],f=p()("nodePanel-box",{"nodePanel-box-visible":a}),m=function(e){n&&n(e)};return o.createElement("div",{className:"nodePanel"},o.createElement("div",{className:f},o.createElement("div",{className:"nodePanel-box-collapse"},o.createElement(g.a,{activeKey:l,onChange:function(e){u(e)},bordered:!0,accordion:!0},t.map((function(e){var t=x[e].length;return o.createElement(S,{key:e,header:o.createElement("div",{className:"collapse-title"},"".concat(b[e]," (").concat(t,")"))},o.createElement("div",{className:"components-box"},x[e].map((function(e){var t=p()("components-box-item",{"components-box-item-disabled no-drop":e.disabled});return o.createElement("div",{className:t,key:e.key,draggable:!0,onDrag:m.bind(null,e)},o.createElement("div",{className:"components-box-item-icon"},e.icon))}))))}))))))}var D=n(34);function O(){var e=document;return e.fullscreenElement||e.webkitFullscreenElement}n(195);var j=o.forwardRef((function(e,t){var n=e.screenScale,r=e.changeScreenScale,i=e.handleResizeTo,a=e.items,c=e.onShear,s=e.onCopy,l=e.onPaste,u=e.onDelete,d=e.onDragSelect,f=e.onSave,m=String(Math.round(n)),v=a.includes("save"),g=a.includes("fullscreen"),h=a.includes("zoom"),y=(a.includes("adapt"),a.includes("format"),a.includes("shear")),k=a.includes("copy"),b=a.includes("paste"),w=a.includes("delete"),E=a.includes("dragSelect"),x=O(),N=function(e){var t=n;e?(t=n+10)>200&&(t=200):(t=n-10)<50&&(t=50),i(t/100),r(t)},L=function(){var e;O()?document.exitFullscreen||document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e=t.current).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()};return o.createElement("div",{className:"toolbar"},o.createElement("div",{className:"toolbar-scale"},m,"%"),o.createElement("div",{className:"toolbar-button"},function(){var e=p()({fullscreen:!x,"fullscreen-exit":x});return o.createElement(o.Fragment,null,h&&o.createElement(o.Fragment,null,o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"zoom-in",onClick:N.bind(null,!0)})),o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"zoom-out",onClick:N.bind(null,!1)}))),v&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"save",onClick:f})),g&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:e,onClick:L})),y&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"scissor",onClick:c})),k&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"copy",onClick:s})),b&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"snippets",onClick:l})),w&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"delete",onClick:u})),E&&o.createElement("div",{className:"toolbar-btn"},o.createElement(D.a,{type:"border-outer",onClick:d})))}()))}));n(196);function R(e){var t=e.id,n=e.style,r=e.onContextMenu,i=e.onClick,a=e.object,c=e.lineAppendWidth,s=e.path,l=e.startArrow,u=e.endArrow,d=n.fill,m="";"boolean"===typeof l?l&&(m="url(#flow-startArrow)"):o.isValidElement(l)&&(m="url(#".concat(l.props.id,")"));var v="";return"boolean"===typeof u?l&&(v="url(#flow-startArrow)"):o.isValidElement(u)&&(v="url(#".concat(u.props.id,")")),o.createElement("g",{key:"".concat(t).concat("_"),className:"editor-link"},o.createElement("defs",null,o.isValidElement(l)?o.cloneElement(l):o.createElement("marker",{id:"flow-startArrow",markerWidth:"10",markerHeight:"10",refX:"0",refY:"2",orient:"auto",markerUnits:"strokeWidth"},o.createElement("path",{d:"M0,0 L0,4 L4,2 z",fill:d}))),o.createElement("defs",null,o.isValidElement(u)?o.cloneElement(u):o.createElement("marker",{id:"flow-endArrow",markerWidth:"10",markerHeight:"10",refX:"0",refY:"2",orient:"auto",markerUnits:"strokeWidth"},o.createElement("path",{d:"M0,0 L0,4 L4,2 z",fill:d}))),o.createElement("path",{key:t,className:"editor-link-path",stroke:f.get(n,"stroke",""),strokeWidth:f.get(n,"strokeWidth",0),d:s,markerStart:m,markerEnd:v}),o.createElement("path",{key:"".concat(t,"-background"),className:"editor-link-path editor-link-path-background",style:{strokeWidth:c},d:s,onContextMenu:r,onClick:i}),o.createElement("g",null,a))}n(197);var M=o.useRef,P=o.useState,T=o.useEffect;o.useCallback;var z=o.forwardRef((function(e,t){var n=e.x,r=e.y,i=e.id,a=e.onClick,c=e.onContextMenu,s=e.children,l=e.currTrans,u=e.width,f=e.height,m=e.isSelected,v=e.onResize,p=P(!1),g=Object(d.a)(p,2),h=g[0],y=g[1],k=M(null),b=function(e,t){var n=t.width,r=t.height,i=t.x,a=t.y,c=Object(o.useState)(n),s=Object(d.a)(c,2),l=s[0],u=s[1],f=Object(o.useState)(r),m=Object(d.a)(f,2),v=m[0],p=m[1],g=Object(o.useState)(i),h=Object(d.a)(g,2),y=h[0],k=h[1],b=Object(o.useState)(a),w=Object(d.a)(b,2),E=w[0],x=w[1];return Object(o.useEffect)((function(){k(i),x(a)}),[i,a]),Object(o.useEffect)((function(){var t=document.querySelectorAll(".resizer"),o=document.querySelector(".resizable"),i=0,a=0,c=0,s=0;if(e)for(var l=function(e){var l=t[e];l.addEventListener("mousedown",(function(e){e.preventDefault(),i=parseFloat(getComputedStyle(o,null).getPropertyValue("width").replace("px","")),a=parseFloat(getComputedStyle(o,null).getPropertyValue("height").replace("px","")),o.getBoundingClientRect().left,o.getBoundingClientRect().top,c=e.pageX,s=e.pageY,window.addEventListener("mousemove",d),window.addEventListener("mouseup",f)}));var d=function(e){var t=0,o=0;l.classList.contains("bottom-right")?(t=i+(e.pageX-c),o=a+(e.pageY-s),t>20&&u(t),o>20&&p(o)):l.classList.contains("bottom-left")?(t=i-(e.pageX-c),o=a+(e.pageY-s),t>20&&(u(t),k(y+(e.pageX-c))),o>20&&p(o)):l.classList.contains("top-right")?(t=i+(e.pageX-c),o=a-(e.pageY-s),t>20&&u(t),o>20&&(p(o),x(E+(e.pageY-s)))):(t=i-(e.pageX-c),o=a-(e.pageY-s),n>20&&(u(t),k(y+(e.pageX-c))),r>20&&(p(o),x(E+(e.pageY-s))))},f=function(){window.removeEventListener("mousemove",d)}},d=0;d<t.length;d++)l(d)}),[e,l,v,p,u,E,y,x,k]),{width:l,height:v,x:y,y:E}}(m,{width:u,height:f,x:n,y:r}),w=b.width,E=b.height,x=b.x,N=b.y,L=[{position:"left",style:{left:"-5px",top:"".concat(f/2-5,"px")}},{position:"right",style:{right:"-5px",top:"".concat(f/2-5,"px")}},{position:"top",style:{left:"".concat(u/2-5,"px"),top:"-5px"}},{position:"bottom",style:{left:"".concat(u/2-5,"px"),top:"".concat(f-5,"px")}}],S=o.createElement("div",{className:"resizable"},o.createElement("div",{className:"resizers"},["top-left","top-right","bottom-left","bottom-right"].map((function(e){return o.createElement("div",{key:e,className:"resizer ".concat(e),"data-type":"resize"})})))),C=o.createElement("div",{className:"editor-node-selector",style:{width:u,height:f}},L.map((function(e){return o.createElement("a",{"data-type":"edge","data-position":e.position,key:e.position,className:"node-selector",style:e.style})})));return T((function(){v(w,E,x,N)}),[w,E,x,N]),o.createElement("div",{className:"editor-node",style:{left:n,top:r,width:u,height:f},ref:t,onClick:a,onMouseEnter:function(){return y(!0)},onMouseLeave:function(){return y(!1)},onContextMenu:function(e){e.preventDefault(),e.stopPropagation();var t=k.current.getBoundingClientRect();t.id=i;var o=function(e){for(var t=0,n=0,r=e;r!==window.document.body&&null!=r;)n+=r.offsetLeft,t+=r.offsetTop,r=r.offsetParent;return{offsetTop:t,offsetLeft:n}}(t.current),a=o.offsetTop,s=o.offsetLeft,u=e.clientX-s,d=e.clientY-a,f=(u-n)/l.k,m=(d-r)/l.k;c&&c({left:f,top:m},e)}},(m||h)&&C,m&&S,o.cloneElement(s,{ref:k}))}));var F=function(e,t){var n=W(),r=e.x*n,o=t.x*n,i=(r+o)/2,a=(e.y+t.y)/2,c=30,s=t.y-e.y;return s>-100&&s<100&&(c=Math.max(Math.abs(t.y-e.y)/2,20)),["M",r,e.y,"Q",r+c,e.y,i,a,"T",o-6,t.y-2].join(" ")};function W(){var e=window.outerWidth/window.innerWidth,t=window.screen,n=navigator.userAgent.toLowerCase();void 0!==window.devicePixelRatio?e=/macintosh|mac os x/i.test(n)?window.outerWidth/window.innerWidth:window.devicePixelRatio:n.indexOf("msie")>-1?t.deviceXDPI&&t.logicalXDPI&&(e=t.deviceXDPI/t.logicalXDPI):void 0!==window.outerWidth&&void 0!==window.innerWidth&&(e=window.outerWidth/window.innerWidth);return e&&(e=Math.round(100*e)/100),e}function A(e,t){var n=(null===e||void 0===e?void 0:e.x)+(null===e||void 0===e?void 0:e.width),r=(null===e||void 0===e?void 0:e.y)+(null===e||void 0===e?void 0:e.height)/2;return"left"===t?(n=null===e||void 0===e?void 0:e.x,r=(null===e||void 0===e?void 0:e.y)+(null===e||void 0===e?void 0:e.height)/2):"right"===t?(n=(null===e||void 0===e?void 0:e.x)+(null===e||void 0===e?void 0:e.width),r=(null===e||void 0===e?void 0:e.y)+(null===e||void 0===e?void 0:e.height)/2):"top"===t?(n=(null===e||void 0===e?void 0:e.x)+(null===e||void 0===e?void 0:e.width)/2,r=null===e||void 0===e?void 0:e.y):"bottom"===t&&(n=(null===e||void 0===e?void 0:e.x)+(null===e||void 0===e?void 0:e.width)/2,r=(null===e||void 0===e?void 0:e.y)+(null===e||void 0===e?void 0:e.height)),{x:n,y:r}}var X=o.useCallback,I=o.useEffect,Y=o.useState,q=o.useRef,U={x:0,y:0,width:0,height:0,direction:"left"};n(198);var H=o.useRef,B=o.useCallback,V=o.useMemo;function K(e){var t=e.overlayColor,n=e.selectorStyle,r=e.visible,i=e.onClose,a=e.getPopupContainer,c=H(null),s=function(e,t){var n=Y(U),r=Object(d.a)(n,2),o=r[0],i=r[1],a=Y(""),c=Object(d.a)(a,2),s=c[0],l=c[1],u=q(0),f=q(0),m=X((function(e){var n=e.layerX,r=e.layerY,o=Math.abs(n-u.current),a=Math.abs(r-f.current),c=n-u.current,s={x:u.current,y:f.current,width:o,height:a,direction:c<0?"right":"left"},d=function(e,t){var n=t.x,r=t.y,o=t.width,i=t.height,a=t.direction,c="";return"rect"===e&&(c="M".concat(n," ").concat(r," h ").concat(o," v ").concat(i," h -").concat(o," Z"),"right"===a&&(c="M".concat(n," ").concat(r," h -").concat(o," v -").concat(i," h ").concat(o," Z"))),c}(t,s);l(d),i(s)}),[i,t]),v=X((function(t){t.stopPropagation(),l(""),u.current=0,f.current=0,e.current.removeEventListener("mousemove",m)}),[e,m]),p=X((function(t){t.stopPropagation(),u.current=t.layerX,f.current=t.layerY,e.current.addEventListener("mousemove",m),e.current.addEventListener("mouseup",v)}),[e,m,v]);return I((function(){var t=e.current;return t.addEventListener("mousedown",p),function(){t.removeEventListener("mousedown",p)}}),[e,p]),{shapeProps:o,pathData:s}}(c,"rect"),l=s.shapeProps,f=s.pathData,m=B((function(e){e.stopPropagation(),e.preventDefault(),i&&i(l)}),[i,l]);return V((function(){var e,i=p()("drag-select-container",{"drag-select-hidden":!r}),s=a(),l=function(e){if(!e)return 0;var t=window.getComputedStyle(e);return e.getBoundingClientRect().width+Number(t.marginLeft.match(/\d+/g))+Number(t.marginRight.match(/\d+/g))}(s),d=function(e){if(!e)return 0;var t=window.getComputedStyle(e);return e.getBoundingClientRect().height+Number(t.marginTop.match(/\d+/g))+Number(t.marginBottom.match(/\d+/g))}(s),v=(e=s)?{x:e.getBoundingClientRect().x,y:e.getBoundingClientRect().y}:0;return o.createElement("svg",{ref:c,className:i,width:l,height:d,style:{background:t,left:null===v||void 0===v?void 0:v.x,top:null===v||void 0===v?void 0:v.y},xmlns:"http://www.w3.org/2000/svg",onDrag:function(e){e.preventDefault()},onClick:m},o.createElement("g",null,o.createElement("path",{d:f,style:Object(u.a)({},n)})))}),[t,m,n,r,f])}var J=n(118),Z=n(127),_=n(119),$=n(73),Q=n(128),G=n(92),ee=n(224),te=(n(204),function(e){var t=e.id,n=e.visible,r=e.left,i=e.top,a=e.children;return o.createElement("div",{id:t?"context-menu-".concat(t):"context-menu",style:{display:n?"block":"none",left:r,top:i},className:"contextMenu-layer"},o.createElement("div",{className:"contextMenu"},a))});function ne(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"click",r=Object(o.useRef)(),i=Object(o.useCallback)((function(n){var o=("function"===typeof t?t():t)||r.current;o&&!o.contains(n.target)&&e(n)}),[r.current,e,t]);return Object(o.useEffect)((function(){return document.addEventListener(n,i),function(){document.removeEventListener(n,i)}}),[n,i]),r}n(205);var re=o.useState,oe=o.useRef,ie=(o.useMemo,o.useCallback);function ae(e){var t=e.currentNode,n=e.onSelect,r=(e.hasError,e.isSelected),i=e.isDragged,a=e.onClick,c=e.interactive,s=void 0===c||c,l=e.currTrans,u=e.nodeRef,f=e.onResize,m=(e.showSelector,e.id,re(!1)),v=Object(d.a)(m,2),g=v[0],h=v[1],y=re({left:0,top:0}),k=Object(d.a)(y,2),b=k[0],w=k[1];ne((function(){h(!1)}),(function(){return document.querySelector(".editorNode-box-menu")}),"contextmenu");var E=ne((function(){h(!1)})),x=oe(null),L="";L=r?"selected ".concat(t.key,"-clicked ").concat(t.key,"-border"):"".concat(t.key,"-border");var S="circle"===t.key,C="rectRadius"===t.key,D="diamond"===t.key,O=p()("editorNode-box",L,{dragging:i},{"editorNode-circle":S},{"editorNode-rectRadius":C}),j=[{name:"\u5220\u9664",key:N.delete,disabled:!1}],R=function(e){var r=e.key;n(t,r),h(!1)},M=ie((function(e){s&&a&&a(t,e)}),[s,a,t]);return o.createElement(z,{id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,currTrans:l,ref:u,isSelected:r,onClick:M,onResize:f,onContextMenu:s?function(t,n){n.stopPropagation(),n.preventDefault();var r={left:t.left,top:t.top};w(r),h(!0),e.onContextMenu&&e.onContextMenu(n)}:null},o.createElement("div",{className:"editorNode",ref:x},o.createElement("div",{className:O,style:{transform:D?"rotateZ(45deg) skew(30deg,30deg)":"none"}},o.createElement("div",{className:"editorNode-box-property"},o.createElement("div",{className:"editorNode-name"},t.name)),o.createElement("div",{className:"editorNode-box-menu",ref:E},o.createElement(te,{id:t.id,visible:g,left:b.left,top:b.top},o.createElement(ee.a,{getPopupContainer:function(e){return e.parentNode}},j.map((function(e){return o.createElement(ee.a.Item,{key:e.key,onClick:R},e.name)}))))))))}n(216);function ce(e){var t=e.links,n=e.nodes,r=e.selectedLinks,i=e.onSelectLink,a=e.onContextMenu,c=e.isDraggingLink,s=e.dragLink,l=e.interactive,u=void 0===l||l,d=t.map((function(e){var t=e.source,c=e.target,s=e.id,l=e.sourcePos,d=e.targetPos,m=f.find(n,(function(e){return e.id===t})),v=f.find(n,(function(e){return e.id===c})),p=A(m,l),g=p.x,h=p.y,y=A(v,d),k=y.x,b=y.y,w=F({x:g,y:h},{x:k,y:b}),E=!!r&&r.includes(s)?"#92ade3":"#b4bdcf",x={fill:E,stroke:E,strokeWidth:2};return o.createElement(R,{key:s,id:s,path:w,lineAppendWidth:15,style:x,onContextMenu:u?a.bind(null,s):null,onClick:u?i.bind(null,s):null,endArrow:o.createElement("marker",{id:"".concat(s,"-endArrow"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"2",orient:"auto",markerUnits:"strokeWidth"},o.createElement("path",{d:"M0,0 L0,4 L4,2 z",fill:E}))})}));return o.createElement("svg",{className:"editor-view-svg"},t&&d,u&&function(){if(c){var e=s.x,t=s.y,n=s.originX,r=s.originY,i=F({x:n,y:r},{x:e,y:t});return o.createElement(R,{path:i,endArrow:o.createElement("marker",{id:"".concat("#52619b","-endArrow"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"2",orient:"auto",markerUnits:"strokeWidth"},o.createElement("path",{d:"M0,0 L0,4 L4,2 z",fill:"#52619b"})),style:{fill:"#52619b",stroke:"#52619b",strokeWidth:2}})}return null}())}var se=function(e,t,n){var r=null,o=1/0,i="";return t.forEach((function(t){var n=1/0;["left","right","top","bottom"].forEach((function(a){var c,s;"left"===a?(c=t.x,s=t.y+t.height/2):"right"===a?(c=t.x+t.width,s=t.y+t.height/2):"top"===a?(c=t.x+t.width/2,s=t.y):"bottom"===a&&(c=t.x+t.width/2,s=t.y+t.height),n=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}({x:e.x,y:e.y},{x:c,y:s}),o>n&&(o=n,r=t,i=a)}))})),o<=n?{targetNode:r,targetPos:i}:null};function le(e){for(var t=0,n=0,r=e;r!==window.document.body&&null!=r;)n+=r.offsetLeft,t+=r.offsetTop,r=r.offsetParent;return{offsetTop:t,offsetLeft:n}}G.Utils.Point;var ue=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(Z.a)(this,Object(_.a)(t).call(this,e))).nodesContainerRef=void 0,n.container=void 0,n.screenWidth=void 0,n.screenHeight=void 0,n.autoVerticalScroller=null,n.autoHorizontalScroller=null,n.handleResize=void 0,n.handleAdapt=void 0,n.handleResizeTo=void 0,n.openContainerMenu=function(e){e.preventDefault()},n.toggleDragNode=function(e){e?(window.addEventListener("mousemove",n.onDragNodeMouseMove),window.addEventListener("mouseup",n.onDragNodeMouseUp)):(window.removeEventListener("mousemove",n.onDragNodeMouseMove),window.removeEventListener("mouseup",n.onDragNodeMouseUp))},n.toggleDragLink=function(e){e?(window.addEventListener("mousemove",n.onDragLinkMouseMove),window.addEventListener("mouseup",n.onDragLinkMouseUp)):(window.removeEventListener("mousemove",n.onDragLinkMouseMove),window.removeEventListener("mouseup",n.onDragLinkMouseUp))},n.onDragLinkMouseMove=function(e){e.stopPropagation(),e.preventDefault();var t=le(n.container.current),r=t.offsetTop,o=t.offsetLeft,i=e.clientX-o,a=e.clientY-r,c=n.props.currTrans,s=c.k,l=c.x,d=c.y;n.setState((function(e){var t=e.dragLink;return{dragLink:Object(u.a)({},t,{x:(i-l)/s,y:(a-d)/s})}}))},n.onNodesContainerMouseDown=function(e){e.stopPropagation();var t=n.props.nodes;if(t&&t.length>0){var r=f.find(t,(function(t){return!(!t.ref||!t.ref.current)&&t.ref.current.contains(e.target)})),o=e.target.dataset&&e.target.dataset.type,i=e.target.dataset&&e.target.dataset.position;if(r){if("edge"===o&&i)return void n.onDragLinkMouseDown(r,i);if("resize"===o)return;n.onDragNodeMouseDown(r,e)}}},n.onContainerMouseDown=function(e){var t=e.path;n.hasNodeOrLink(t,"editor-node","editor-link")||n.handleClearActive()},n.onNodesContainerMouseMove=function(e){e.preventDefault();var t=e.path,r=n.hasNodeOrLink(t,"editor-node","editor-link"),o=n.props.nodes;if(o&&o.length>0){var i=f.find(o,(function(t){return!(!t.ref||!t.ref.current)&&t.ref.current.contains(e.target)}));i&&(r?n.setState({currentHoverNode:i.id}):n.setState({currentHoverNode:""}))}},n.onDragNodeMouseDown=function(e,t){var r=n.props.currTrans,o=r.k,i=r.x,a=r.y,c=le(n.container.current),s=c.offsetTop,l=c.offsetLeft,u=t.clientX-l,d=t.clientY-s;n.setState((function(t){return{isDraggingNode:!0,dragNode:e,dragNodeOffset:{x:(u-i)/o-e.x,y:(d-a)/o-e.y}}}))},n.onDragLinkMouseDown=function(e,t){var r=A(e,t),o=r.x,i=r.y;n.setState({isDraggingLink:!0,dragLink:{originId:e.id,originX:o,originY:i,x:o,y:i},sourcePos:t})},n.onDragLinkMouseUp=function(e){var t=n.props,r=t.setLinks,o=t.links,i=t.nodes,a=n.state.dragLink,c=le(n.container.current),s=c.offsetTop,u=c.offsetLeft,d=e.clientX-u,f=e.clientY-s,m=n.props.currTrans,v=m.k,p=m.x,g=m.y,h=se({x:(d-p)/v,y:(f-g)/v},i,30);if(h){var y=h.targetNode,k=h.targetPos,b={id:a.originId+"_"+y.id+"_"+k,source:a.originId,target:y.id,sourcePos:n.state.sourcePos,targetPos:k};r([].concat(Object(l.a)(o),[b]))}n.setState({isDraggingLink:!1,dragLink:null,sourcePos:""})},n.onDragNodeMouseMove=function(e){e.preventDefault(),e.stopPropagation();var t=n.props,r=t.setNodes,o=t.nodes,i=n.props.currTrans,a=i.k,c=i.x,s=i.y,l=le(n.container.current),d=l.offsetTop,f=l.offsetLeft,m=e.clientX-f,v=e.clientY-d;n.setState((function(e){var t=e.dragNode,n=e.dragNodeOffset,r=(m-c)/a-n.x,o=(v-s)/a-n.y;return Object(u.a)({},e,{dragNode:Object(u.a)({},t,{x:r,y:o})})}));var p=n.state,g=p.dragNodeOffset,h=p.dragNode;r(o.map((function(e){return e.id===h.id?Object(u.a)({},e,{x:(m-c)/a-g.x,y:(v-s)/a-g.y}):e})))},n.onDragNodeMouseUp=function(e){e.stopPropagation(),n.setState((function(e){e.dragNode;return Object(u.a)({},e)})),n.setState({isDraggingNode:!1})},n.getTransformInfo=function(e){n.props.setCurrTrans(e)},n.getScreenHandler=function(e){n.handleResize=e.handleResize,n.handleResizeTo=e.handleResizeTo,n.handleAdapt=e.handleAdapt,n.screenWidth=e.screenWidth,n.screenHeight=e.screenHeight},n.handleClearActive=function(){n.props.setSelectedLinks([]),n.props.setSelectedNodes([])},n.hasNodeOrLink=function(e,t,n){for(var r=!1,o=0;o<e.length;o++){var i=f.includes(e[o].classList,t),a=f.includes(e[o].classList,n);if(i||a){r=!0;break}}return r},n.changeScreenScale=function(e){n.setState({screenScale:e})},n.handleFullScreen=function(){var e;(function(){var e=document;return e.fullscreenElement||e.webkitFullscreenElement})()?document.exitFullscreen||document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e=n.container.current).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},n.onSelectLink=function(e){var t=n.props,r=t.selectedLinks,o=t.setSelectedLinks;if(r){var i=f.findIndex(r,(function(t){return t===e}));o(i>-1?[].concat(Object(l.a)(r.slice(0,i)),Object(l.a)(r.slice(i+1))):[].concat(Object(l.a)(r),[e]))}else o([e])},n.onClickNode=function(e){var t=n.props,r=t.selectedNodes,o=t.setSelectedNodes;if(n.state.isKeyPressing)if(r){var i=f.findIndex(r,(function(t){return t===e.id}));o(i>-1?[].concat(Object(l.a)(r.slice(0,i)),Object(l.a)(r.slice(i+1))):f.compact([].concat(Object(l.a)(r),[e.id])))}else o([e.id]);else n.props.setSelectedNodes([e.id]),n.props.setSelectedLinks(null)},n.onSelectNode=function(e,t){var r=n.props,o=r.selectedNodes,i=r.deleteNodes;t===N.delete&&(o&&o.includes(e.id)?i(f.compact([].concat(Object(l.a)(o),[e.id]))):i([e.id]))},n.onContextMenuLink=function(e,t){t.preventDefault(),t.stopPropagation(),n.props.setSelectedLinks([e]),n.props.setSelectedNodes(null);var r={x:t.clientX,y:t.clientY};n.setState({deleteVisible:!0,menuPos:r})},n.onResize=function(e,t,r,o,i){(0,n.props.updateNodes)(Object(u.a)({},e,{width:t,height:r,x:o,y:i}))},n.renderCanvas=function(){var e=n.state.currentHoverNode,t=n.props,r=t.nodes,i=t.links,a=t.selectedNodes,c=t.selectedLinks;return o.createElement("div",{className:"editor-view"},o.createElement("div",{className:"editor-view-content",ref:n.nodesContainerRef},r.map((function(t){var r=t.id,i=!!a&&a.includes(r),c=i||e===r;return o.createElement(ae,{nodeRef:t.ref,currentNode:t,key:r,onClick:n.onClickNode,isSelected:i,showSelector:c,onResize:n.onResize.bind(Object($.a)(n),t),currTrans:n.props.currTrans,onSelect:n.onSelectNode})})),o.createElement(ce,{links:i,nodes:r,selectedLinks:c,onContextMenu:n.onContextMenuLink,onSelectLink:n.onSelectLink,isDraggingLink:n.state.isDraggingLink,dragLink:n.state.dragLink})))},n.state={isDraggingNode:!1,isDraggingLink:!1,isKeyPressing:!1,dragNode:null,dragLink:null,dragNodeOffset:null,menuDisplay:!1,menuPos:{id:"",x:0,y:0},screenScale:100,sourcePos:"",currentHoverNode:"",deleteVisible:!1},n.nodesContainerRef=o.createRef(),n.container=o.createRef(),n}return Object(Q.a)(t,e),Object(J.a)(t,[{key:"componentDidMount",value:function(){this.nodesContainerRef.current.addEventListener("mousedown",this.onNodesContainerMouseDown),this.container.current.addEventListener("contextmenu",this.openContainerMenu),this.container.current.addEventListener("click",this.onContainerMouseDown)}},{key:"componentWillUnmount",value:function(){this.nodesContainerRef.current.removeEventListener("mousedown",this.onNodesContainerMouseDown),this.container.current.removeEventListener("contextmenu",this.openContainerMenu),this.container.current.removeEventListener("click",this.onContainerMouseDown)}},{key:"componentWillUpdate",value:function(e,t){this.state.isDraggingNode!==t.isDraggingNode&&this.toggleDragNode(t.isDraggingNode),this.state.isDraggingLink!==t.isDraggingLink&&this.toggleDragLink(t.isDraggingLink)}},{key:"onDrag",value:function(e,t){}},{key:"onDrop",value:function(e){var t=this.props,n=t.setNodes,r=t.nodes,i=t.dragNode,a=le(this.container.current),c=a.offsetTop,s=a.offsetLeft,u=e.clientX-s,d=e.clientY-c,f=this.props.currTrans,v=f.k,p=f.x,g=f.y;if(i){var h={key:i.key,name:i.name,type:i.type,width:i.width,height:i.height,x:(u-p)/v-110,y:(d-g)/v-30,id:m.v4(),ref:o.createRef()};n([].concat(Object(l.a)(r),[h]))}}},{key:"renderDragSource",value:function(){var e=this;return o.createElement("div",{className:"flow-drag-source"},["\u7ec4\u4ef61","\u7ec4\u4ef62"].map((function(t,n){return o.createElement("div",{className:"flow-drag-source-item",key:n,draggable:!0,onDrag:function(n){return e.onDrag(n,t)}},t)})))}},{key:"render",value:function(){var e=this.state,t=e.deleteVisible,n=e.menuPos;return o.createElement("div",{className:"canvas-container-content",ref:this.container},o.createElement(G.ReScreen,{type:"DOM",getScreenHandler:this.getScreenHandler,needMinimap:!0,needRefresh:!0,zoomEnabled:!1,mapPosition:"RT-IN",mapWidth:200,mapHeight:300,mapRectStyle:{stroke:"#468CFF",fill:"transparent",strokeWidth:1.5},focusEnabled:2,onScreenChange:this.getTransformInfo,onDragOver:function(e){e.preventDefault()},onDrop:this.onDrop.bind(this)},this.renderCanvas()),o.createElement(te,{visible:t,left:n.x,top:n.y},o.createElement(ee.a,{getPopupContainer:function(e){return e.parentNode}},[{name:"\u5220\u9664",key:N.delete}].map((function(e){return o.createElement(ee.a.Item,{key:e.key},e.name)})))))}}]),t}(o.Component),de=n(126);var fe=o.useState,me=o.useEffect;function ve(){var e=fe(),t=Object(d.a)(e,2),n=t[0],r=t[1],i=fe([]),a=Object(d.a)(i,2),f=a[0],m=a[1],v=fe([]),p=Object(d.a)(v,2),g=p[0],h=p[1],y=fe([]),k=Object(d.a)(y,2),b=k[0],w=k[1],E=fe([]),x=Object(d.a)(E,2),N=x[0],L=x[1],S=function(e,t){var n=Object(o.useState)((function(){try{var n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(r){return console.log(r),t}})),r=Object(d.a)(n,2),i=r[0],a=r[1];return[i,function(){var t=Object(s.a)(c.a.mark((function t(n){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){try{var r=n instanceof Function?n(i):n;return a(r),window.localStorage.setItem(e,JSON.stringify(r)),t(!0)}catch(o){return console.log(o),t(!1)}})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()]}("editorData",{id:"editorData-test"}),C=Object(d.a)(S,2),D=C[0],O=C[1],j=fe(null),R=Object(d.a)(j,2),M=R[0],P=R[1],T=fe(de.a),z=Object(d.a)(T,2),F=z[0],W=z[1],A=fe([]),X=Object(d.a)(A,2),I=X[0],Y=X[1];me((function(){var e,t;r(D);var n=(null!==(e=null===D||void 0===D?void 0:D.nodes)&&void 0!==e?e:[]).map((function(e){return Object(u.a)({},e,{ref:o.createRef()})}));m(n),h(null!==(t=null===D||void 0===D?void 0:D.links)&&void 0!==t?t:[])}),[D]);var q=function(){var e=Object(s.a)(c.a.mark((function e(){var t,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=null!==f&&void 0!==f?f:[]).forEach((function(e){return delete e.ref})),e.next=4,O(Object(u.a)({},n,{nodes:t,links:g}));case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{editorData:n,setEditorData:r,nodes:f,setNodes:m,links:g,setLinks:h,updateNodes:function(e){var t=f.findIndex((function(t){return t.id===e.id})),n=[].concat(Object(l.a)(f.slice(0,t)),[e],Object(l.a)(f.slice(t+1)));m(n)},updateLinks:function(e){var t=g.findIndex((function(t){return t.id===e.id})),n=[].concat(Object(l.a)(g.slice(0,t)),[e],Object(l.a)(g.slice(t+1)));h(n)},selectedLinks:b,setSelectedLinks:w,selectedNodes:N,setSelectedNodes:L,dragNode:M,setDragNode:P,copiedNodes:I,setCopiedNodes:Y,currTrans:F,setCurrTrans:W,editorLocalData:D,setEditorLocalData:O,handleSaveData:q}}var pe={esc:27,tab:9,enter:13,space:32,up:38,left:37,right:39,down:40,delete:[8,46]},ge={esc:"Escape",tab:"Tab",enter:"Enter",space:" ",up:["Up","ArrowUp"],left:["Left","ArrowLeft"],right:["Right","ArrowRight"],down:["Down","ArrowDown"],delete:["Backspace","Delete"]},he={ctrl:function(e){return e.ctrlKey},shift:function(e){return e.shiftKey},alt:function(e){return e.altKey},meta:function(e){return e.metaKey}},ye=function(){};function ke(e){return Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,"$1").toLowerCase()}function be(e,t){if("number"===ke(t))return e.keyCode===t;var n=t.split("."),r=0,o=!0,i=!1,a=void 0;try{for(var c,s=n[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var l=c.value,u=he[l],d=ge[l],f=pe[l];(u&&u(e)||(d&&"array"===ke(d)?d.includes(e.key):d===e.key)||(f&&"array"===ke(f)?f.includes(e.keyCode):f===e.keyCode)||e.key.toUpperCase()===l.toUpperCase())&&r++}}catch(m){i=!0,a=m}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}return r===n.length}function we(e){var t=ke(e);return"function"===t?e:"string"===t||"number"===t?function(t){return be(t,e)}:"array"===t?function(t){return e.some((function(e){return be(t,e)}))}:e?function(){return!0}:function(){return!1}}var Ee=["keydown"];function xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ye,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.events,i=void 0===r?Ee:r,a=n.target,c=Object(o.useRef)(),s=Object(o.useRef)(t);s.current=t;var l=Object(o.useCallback)((function(t){if(we(e)(t))return s.current(t)}),[e]);return Object(o.useEffect)((function(){var e="function"===typeof a?a():a,t=c.current||e||window,n=!0,r=!1,o=void 0;try{for(var s,u=i[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var d=s.value;t.addEventListener(d,l)}}catch(f){r=!0,o=f}finally{try{n||null==u.return||u.return()}finally{if(r)throw o}}return function(){var e=!0,n=!1,r=void 0;try{for(var o,a=i[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var c=o.value;t.removeEventListener(c,l)}}catch(f){n=!0,r=f}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}}),[i,l,a]),c}n(217);var Ne=o.useState,Le=o.useRef;o.useEffect;function Se(e){var t=Ne(100),n=Object(d.a)(t,2),r=n[0],i=n[1],a=Ne(!1),v=Object(d.a)(a,2),p=v[0],g=v[1],h=ve(),y=h.nodes,k=h.links,b=h.setNodes,w=h.setLinks,E=h.selectedLinks,x=h.setSelectedLinks,N=h.dragNode,L=h.setDragNode,S=h.selectedNodes,D=h.setSelectedNodes,O=h.updateNodes,R=h.updateLinks,M=h.copiedNodes,P=h.setCopiedNodes,T=h.currTrans,z=h.setCurrTrans,F=h.handleSaveData,W=Le(null),A=Le({getWrappedInstance:function(){return Object}}),X=A.current,I=function(e){if(e){var t=f.cloneDeep(k);e.forEach((function(e){f.remove(t,(function(t){return t.source===e||t.target===e}))})),w(t);var n=f.cloneDeep(y),r=f.remove(n,(function(t){return!e.includes(t.id)}));b(r),x([]),D([])}},Y=function(e){if(e){var t=k.map((function(e){return e.id})),n=f.difference(t,e),r=n?n.map((function(e){return f.find(k,(function(t){return t.id===e}))})):[];w(r)}},q=function(e){var t=e.map((function(e){return f.find(y,(function(t){return t.id===e}))}));P(t)},U=function(){S&&(q(S),I(S))},H=function(){S&&q(S)},B=function(){M&&function(){if(M){var e=M.map((function(e){return Object(u.a)({},e,{id:m.v4(),x:e.x+e.width+20,ref:o.createRef()})}));P(e),b([].concat(Object(l.a)(y),Object(l.a)(e)))}}()},V=function(){S&&I(S),E&&Y(E)},J=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F();case 2:e.sent?alert("\u4fdd\u5b58\u6210\u529f"):alert("\u4fdd\u5b58\u5931\u8d25");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();xe("delete",(function(){V()}),{events:["keydown","keyup"]});var Z=navigator.platform.startsWith("Mac");xe(Z?["meta.x"]:["ctrl.x"],(function(){U()})),xe(Z?["meta.c"]:["ctrl.c"],(function(){H()})),xe(Z?["meta.v"]:["ctrl.v"],(function(){B()}));var _=o.createElement("div",null,o.createElement(j,{ref:W,screenScale:r,changeScreenScale:i,handleResizeTo:X&&X.handleResizeTo,items:["save","fullscreen","zoom","adapt","format","ratio","shear","copy","paste","delete","dragSelect"],layout:X&&X.layout,onCopy:H,onPaste:B,onDelete:V,onShear:U,onDragSelect:function(){g(!p)},onSave:J})),$=o.createElement("div",{className:"editor-nodePanel"},o.createElement(C,{onDrag:L})),Q=o.createElement("div",{className:"editor-canvas"},o.createElement(K,{visible:p,getPopupContainer:function(){return document.querySelector(".editor-canvas")},overlayColor:"rgba(0,0,0,0.1)",selectorStyle:{fill:"transparent",strokeWidth:1,stroke:"#6ca0f5",strokeDasharray:"5 5"},onClose:function(e){var t=T.k,n=T.x,r=T.y,o=y.map((function(e){return{x:t*e.x+n+e.width/2*t,y:t*e.y+r+e.height/2*t,id:e.id}})),i=[];i="left"===e.direction?[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]:[{x:e.x,y:e.y},{x:e.x-e.width,y:e.y},{x:e.x-e.width,y:e.y-e.height},{x:e.x,y:e.y-e.height}];var a=o.map((function(e){if("in"===function(e,t){for(var n=e.x,r=e.y,o=!1,i=0,a=t.length,c=a-1;i<a;c=i,i++){var s=t[i].x,l=t[i].y,u=t[c].x,d=t[c].y;if(s===n&&l===r||u===n&&d===r)return"on";if(l<r&&d>=r||l>=r&&d<r){var f=s+(r-l)*(u-s)/(d-l);if(f===n)return"on";f>n&&(o=!o)}}return o?"in":"out"}(e,i))return e.id}));D(a),g(!1)}}),o.createElement(ue,{dragNode:N,ref:A,nodes:y,links:k,setNodes:b,setLinks:w,selectedLinks:E,setSelectedLinks:x,selectedNodes:S,setSelectedNodes:D,updateNodes:O,updateLinks:R,deleteNodes:I,deleteLinks:Y,copiedNodes:M,setCopiedNodes:P,currTrans:T,setCurrTrans:z})),G=o.createElement("div",{className:"editor-property"});return o.createElement("div",{className:"editor-demo",ref:W},o.createElement("div",{className:"editor-operation"},_),o.createElement("div",{className:"editor-container"},$,Q,G))}n(218);var Ce=document.getElementById("root");Object(i.render)(o.createElement((function(){return o.createElement("div",{className:"App"},o.createElement(Se,null))}),null),Ce)}},[[134,1,2]]]);
//# sourceMappingURL=main.3803b782.chunk.js.map