{"version":3,"sources":["editor/defines.tsx","editor/components/NodePanel.tsx","editor/utils/FullsreenUtils.ts","editor/components/Toolbar.tsx","editor/components/Edge.tsx","editor/utils/types.ts","editor/components/Node.tsx","editor/hooks/useResize.tsx","editor/utils/calc.ts","editor/utils/useDragSelect.ts","editor/components/DragSelector.tsx","editor/ContextMenu.tsx","editor/hooks/useClickAway.tsx","editor/EditorNode.tsx","editor/EditorEdges.tsx","editor/utils/find.ts","utils.tsx","editor/CanvasContent.tsx","editor/mock.ts","editor/hooks/useEditorStore.tsx","editor/hooks/useKeyPress.tsx","editor/index.tsx","editor/utils/layout.ts","index.tsx","App.tsx"],"names":["ComponentType","OutputType","ComponentMap","common","ComponentKey","COMMON_COMPONENT","type","key","rect","name","width","height","icon","style","border","disabled","rectRadius","borderRadius","circle","xmlns","version","cx","cy","r","stroke","strokeWidth","fill","COMPONENT_CATEGORY","OperateType","useState","React","Panel","Collapse","NodePanel","props","componnetList","Object","values","onDrag","visible","collapseKey","setCollapseKey","boxClass","classNames","handleDrag","item","className","activeKey","onChange","items","bordered","accordion","map","total","length","header","child","boxItemClass","draggable","bind","isFull","doc","document","fullscreenElement","webkitFullscreenElement","Toolbar","ref","screenScale","changeScreenScale","handleResizeTo","onShear","onCopy","onPaste","onDelete","onDragSelect","scale","String","Math","round","isFullScreen","includes","isZoom","isShear","isCopy","isPaste","isDelete","isDragSelect","fullscreenStatus","handleResize","isLager","value","handleFullScreen","element","exitFullscreen","webkitExitFullscreen","current","requestFullscreen","mozRequestFullScreen","msRequestFullscreen","webkitRequestFullscreen","fullScreenClassName","fullscreen","onClick","renderButtons","Edge","id","onContextMenu","object","lineAppendWidth","path","startArrow","endArrow","markerStart","endStart","markerWidth","markerHeight","refX","refY","orient","markerUnits","d","_","markerEnd","useRef","useEffect","Node","x","y","children","currTrans","isSelected","onResize","showSelector","setShowSelector","containerRef","isResize","nodeWidth","setNodeWidth","nodeHeight","setNodeHeight","nodeLeft","setNodeLeft","nodeTop","setNodeTop","resizers","querySelectorAll","querySelector","originWidth","originHeight","originMouseX","originMouseY","i","currentResizer","addEventListener","e","preventDefault","parseFloat","getComputedStyle","getPropertyValue","replace","getBoundingClientRect","left","top","pageX","pageY","window","resize","stopResize","newWidth","newHeight","classList","contains","removeEventListener","useResize","resizeWidth","resizeHeight","resizeX","resizeY","NODE_SELECTOR","position","right","renderResize","data-type","renderNodeSelector","data-position","onMouseEnter","onMouseLeave","event","stopPropagation","container","domNode","offsetTop","offsetLeft","targetDomNode","body","offsetParent","getOffset","screenX","clientX","screenY","clientY","newX","k","newY","quadratic","sourcePoint","targetPoint","ratio","detectZoom","sourceX","targetX","centerX","centerY","tolerance","sub","max","abs","join","outerWidth","innerWidth","screen","ua","navigator","userAgent","toLowerCase","undefined","devicePixelRatio","test","indexOf","deviceXDPI","logicalXDPI","calcLinkPosition","node","useCallback","initSelectorProps","direction","useMemo","DragSeletor","overlayColor","selectorStyle","onClose","getPopupContainer","dragSelectContainerRef","shape","shapeProps","setShapeProps","pathData","setPathData","mousdownX","mousdownY","handleMouseMove","layerX","layerY","diffX","newShapeProps","handlePathData","handleMouseUp","handleMouseDown","drag","useDragSelect","handleClick","dom","classes","popupContainer","Number","marginLeft","match","marginRight","getWidth","marginTop","marginBottom","getHeight","background","ContextMenu","display","useClickAway","onClickAway","eventName","handler","el","target","EditorNode","currentNode","onSelect","hasError","isDragged","interactive","nodeRef","menuShow","setMenuShow","menuPos","setMenuPos","menuRef","editorNodeRef","borderColor","isCircle","isRadius","isDiamond","borderClass","dragging","menuList","delete","handleClickMenu","handleClickNode","newPosition","transform","triggerNode","parentNode","Item","EditorEdges","links","nodes","selectedLinks","onSelectLink","isDraggingLink","dragLink","edgesPath","link","source","sourcePos","targetPos","uNode","vertex","vNode","sourceY","targetY","originX","originY","renderDraggingLink","findNearbyNode","point","range","targetNode","minDis","Infinity","forEach","v","minDistance","sqrt","distance","Utils","Point","CanvasContent","nodesContainerRef","screenWidth","screenHeight","autoVerticalScroller","autoHorizontalScroller","handleAdapt","openContainerMenu","toggleDragNode","isDraggingNode","onDragNodeMouseMove","onDragNodeMouseUp","toggleDragLink","onDragLinkMouseMove","onDragLinkMouseUp","setState","preState","onNodesContainerMouseDown","component","c","dataset","onDragLinkMouseDown","onDragNodeMouseDown","onContainerMouseDown","hasNodeOrLink","handleClearActive","onNodesContainerMouseMove","isNodeOrLink","currentHoverNode","dragNode","dragNodeOffset","originId","setLinks","state","nearNode","newLink","setNodes","getTransformInfo","setCurrTrans","getScreenHandler","handleMap","setSelectedLinks","setSelectedNodes","array","inNode","inLink","index","slice","onClickNode","selectedNodes","isKeyPressing","onSelectNode","deleteNodes","onContextMenuLink","currentPos","deleteVisible","updateNodes","renderCanvas","menuDisplay","this","nextProps","nextState","newNode","NODE_WIDTH","NODE_HEIGHT","uuid","needMinimap","needRefresh","zoomEnabled","mapPosition","mapWidth","mapHeight","mapRectStyle","focusEnabled","onScreenChange","onDragOver","onDrop","mockData","fileId","tenantId","projectId","userId","owner","ownerName","createTime","lastModifier","lastModifierName","lastModifyTime","nodeConfig","nodeId","nodeName","nodeOutputNameList","nodeDesc","nodeType","operatorType","cronExpression","nodeContent","remark","params","dsConfig","dsId","dagId","rerunable","validPeriod","priority","nodeStatus","paused","upstreams","dayDiff","periodDiff","sourceNodeId","sourceNodeOutputName","targetNodeId","targetNodeOutputName","nodeFrom","nodeOwner","tags","faultTolerantConfig","errorCount","errorRate","readCount","hops","steps","distribute","parallel","aliasKeyCodeMap","esc","tab","enter","space","up","down","aliasKeyMap","modifierKey","ctrl","ctrlKey","shift","shiftKey","alt","altKey","meta","metaKey","noop","isType","obj","prototype","toString","call","genFilterKey","keyFilter","keyCode","genArr","split","genLen","genModifier","aliasKey","aliasKeyCode","toUpperCase","genKeyFormater","some","defaultEvents","useKeyPress","eventHandler","option","events","callbackRef","callbackHandler","genGuard","targetElement","EditorDemo","dragSelectable","setDragSelectable","editorData","setEditorData","setDragNode","zoomIdentity","copiedNodes","setCopiedNodes","newNodes","updateLinks","useEditorStore","screenRef","canvasRef","getWrappedInstance","canvasInstance","handleDeleteNodes","ids","newLinks","cloneNodes","handleDeleteLinks","activeLinks","linkList","diffLinks","handleNodesCopy","newCopiedNodes","handleShear","handleCopy","handlePaste","currentCopied","handleNodesPaste","handleDelete","isMac","platform","startsWith","renderOperation","layout","renderNodePanel","strokeDasharray","selectorProps","points","poly","p","px","py","flag","l","j","sx","sy","tx","ty","pointInPoly","deleteLinks","renderProperty","rootElement","getElementById","render"],"mappings":"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","file":"static/js/main.a2ac5a30.chunk.js","sourcesContent":["/**\n * @file 管道画布常量定义\n */\n\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport { Icon } from \"antd\";\n\n// 组件卡片宽度高度\nexport const NODE_WIDTH = 220;\nexport const NODE_HEIGHT = 60;\n\n// 右边菜单栏宽度\nexport const MENU_WIDTH = 120;\nexport const MENU_HEIGHT = 196;\n// 右边抽屉宽度-通用\nexport const RIGHTDRAWER_WIDTH = 521;\n// 右边抽屉宽度-调度配置\nexport const SHECHEDULE_RIGHTDRAWER_WIDTH = 750;\n\n// 支持缩放的最大值跟最小值\nexport const MAX_SCALE = 200;\nexport const MIN_SCALE = 50;\n\n// 组件之间的间距\nexport const COMPONENT_DISTANCE = 30;\n\n// 全屏状态的坐标差,顶部导航到画布的距离\nexport const fullscreenDiffY = 130;\n\n// 顶部导航到画布的固定举例，用于计算Context\nexport const CONTEXT_HEIGHT_DIFF = 155;\n\n// 连接符\nexport const CONNECTOR = \"_\";\n\n// 连线可连线的区域\nexport const LINK_AREA = 30;\n\n// 连线不同状态的颜色\n// 未连接状态\nexport const UNLINK = \"#52619b\";\n// 选中状态\nexport const ACTIVE = \"#92ade3\";\n// 连接状态\nexport const LINK = \"#b4bdcf\";\n\n// 管道节点code为30，为固定值\nexport const operatorTypeCode = 30;\n\ninterface StatusItem {\n  key: string;\n  text: string;\n  icon: React.ReactNode;\n}\n\n// 组件库类型\nexport enum ComponentType {\n  /** 通用 */\n  common = \"common\"\n  /** 自定义 */\n  // self = 'self'\n}\n\nexport const ComponentMap: Record<ComponentType, string> = {\n  [ComponentType.common]: \"通用\"\n  // [ComponentType.self]: '自定义'\n};\n\nexport class Node {\n  /** 组件类型 */\n  type?: string;\n\n  /** 组件key */\n  key: string;\n\n  /** 组件名称 */\n  name: string;\n\n  /** 组件icon */\n  icon?: React.ReactNode;\n\n  /** 组件在画布中的横坐标 */\n  x?: number;\n\n  /** 组件在画布中的纵坐标 */\n  y?: number;\n  /** 生成 id */\n\n  width?: number;\n\n  height?: number;\n\n  id?: string;\n\n  /** 对应的 ref */\n  ref?: any;\n\n  /** 数据分发方式, true:轮流 false:copy */\n  distribute?: boolean;\n\n  /** 其他配置信息 */\n  webConfig?: {};\n\n  disabled?: boolean;\n}\n\nexport class NodePanel {\n  type: string;\n\n  key: string;\n\n  name: string;\n\n  icon: React.ReactNode;\n\n  disabled: boolean;\n}\n\nexport enum OutputType {\n  /** 主步骤输出 */\n  mainOutput = \"mainOutput\",\n  /** 错误步骤输出 */\n  errorOutput = \"errorOutput\"\n}\n\nexport type LINK_POSITION = \"left\" | \"right\" | \"top\" | \"bottom\";\n\nexport interface Link {\n  /** 连线的唯一id, source+CONNECTOR+target的形式 */\n  id: string;\n  /** 来源节点id */\n  source: string;\n  /** 去向节点id */\n  target: string;\n  /** 来源节点位置 */\n  sourcePos?: string;\n  /** 去向节点位置 */\n  targetPos?: string;\n}\n\nexport type LinkType = \"error\" | \"distribute\" | \"copy\";\n\n// 连线中不同状态的icon\nexport const LinkTypeIconMap: Record<LinkType, string> = {\n  error: \"icon-cuowu\",\n  distribute: \"icon-fenfa\",\n  copy: \"icon-fuzhi1\"\n};\n\n// 连线中的icon，宽高\nexport const LINKICON_WIDTH = 18;\nexport const LINKICON_HEIGHT = 18;\n\nexport enum ComponentKey {\n  rect = \"rect\",\n  rectRadius = 'rectRadius',\n  circle = \"circle\",\n  diamond = \"diamond\",\n  polygon = \"polygon\",\n  ellipse = \"ellipse\",\n  star = \"star\"\n}\n\n// 单元类型\n// 输入组件\nconst COMMON_COMPONENT: Node[] = [\n  /** 矩形 */\n  {\n    type: ComponentType.common,\n    key: ComponentKey.rect,\n    name: \"RECT\",\n    width: 100,\n    height: 100,\n    icon: (\n      <div style={{ width: 36, height: 36, border: \"2px solid #52619b\" }} />\n    ),\n    disabled: false\n  },\n  /** 矩形带圆角 */\n  {\n    type: ComponentType.common,\n    key: ComponentKey.rectRadius,\n    name: \"RECT-RADIU\",\n    width: 100,\n    height: 100,\n    icon: (\n      <div style={{ width: 36, height: 36, border: \"2px solid #52619b\", borderRadius: 10 }} />\n    ),\n    disabled: false\n  },\n  /** 圆形 */\n  {\n    type: ComponentType.common,\n    key: ComponentKey.circle,\n    name: \"CIRCLE\",\n    width: 100,\n    height: 100,\n    icon: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        version=\"1.1\"\n        width=\"72px\"\n        height=\"40px\"\n      >\n        <circle\n          cx=\"36\"\n          cy=\"20\"\n          r=\"18\"\n          stroke=\"#52619b\"\n          strokeWidth=\"2\"\n          fill=\"transparent\"\n        />\n      </svg>\n    ),\n    disabled: false\n  },\n  /** TODO 菱形 */\n  // {\n  //   type: ComponentType.common,\n  //   key: ComponentKey.diamond,\n  //   name: \"DIAMOND\",\n  //   width: 100,\n  //   height: 100,\n  //   icon: (\n  //     <div className=\"diamond\">\n        \n  //     </div>\n  //   ),\n  //   disabled: false\n  // }\n  /** 多边形 */\n  // {\n  //   type: ComponentType.common,\n  //   key: ComponentKey.polygon,\n  //   name: 'POLYGON',\n  //   icon: <Icon type=\"border\" />,\n  //   width: 100,\n  //   height: 100,\n  //   disabled: true\n  // },\n  // /** 椭圆 */\n  // {\n  //   type: ComponentType.common,\n  //   key: ComponentKey.ellipse,\n  //   name: 'ELLIPSE',\n  //   icon: <Icon type=\"border\" />,\n  //   width: 100,\n  //   height: 100,\n  //   disabled: true\n  // }\n];\n\n// const SELF_COMPONENT: Node[] = [\n//   {\n//     type: ComponentType.self,\n//     key: ComponentKey.star,\n//     name: 'STAR'\n//   }\n// ];\n\n// 组件库类目\nexport const COMPONENT_CATEGORY: Record<ComponentType, Node[]> = {\n  [ComponentType.common]: COMMON_COMPONENT\n  // [ComponentType.self]: SELF_COMPONENT\n};\n\nexport const keyCodeMap = {\n  delete: 8,\n  copy: 67,\n  paste: 86\n};\n\n/** 处理弹窗全屏挂载 */\nexport function getContainer() {\n  const pipelineDoms = document.getElementsByClassName(\"pipeline-canvas\");\n  return _.find(\n    pipelineDoms,\n    dom => (dom as HTMLElement).offsetParent\n  ) as HTMLElement;\n}\n\n/**\n * @file 类型定义文件\n */\nclass Vertex {\n  id: string;\n\n  x: number;\n\n  y: number;\n\n  width: number;\n\n  height: number;\n}\n\nclass Edge {\n  u: string;\n\n  v: string;\n}\n\ntype MenuType = \"vertex\" | \"edge\";\nclass MenuPos {\n  id?: string;\n\n  x: number;\n\n  y: number;\n}\n\n// 节点宽高\nexport const VERTEX_WIDTH = 180;\nexport const VERTEX_HEIGHT = 32;\n\nexport { Vertex, Edge, MenuPos };\n\n// 操作类型\nexport enum OperateType {\n  configuration = \"configuration\",\n  copy = \"copy\",\n  delete = \"delete\",\n  parallelism = \"parallelism\",\n  outputType = \"outputType\",\n  mainOutput = \"mainOutput\",\n  errorOutput = \"errorOutput\",\n  dataMethod = \"dataMethod\",\n  copyMethod = \"copyMethod\",\n  distribute = \"distribute\",\n  paste = \"paste\",\n  deleteLink = \"deleteLink\",\n  selectAll = \"selectAll\",\n  dragSelect = \"dragSelect\"\n}\n","/**\n * @file 画布侧边栏组件库面板\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport classNames from \"classnames\";\nimport { Collapse } from \"antd\";\nimport {\n  ComponentType,\n  ComponentMap,\n  COMPONENT_CATEGORY,\n  Node\n} from \"../defines\";\nimport \"./NodePanel.scss\";\n\nconst { useState, useEffect } = React;\nconst Panel = Collapse.Panel;\n\ninterface NodePanelProps {\n  visible?: boolean;\n  onDrag?: (item: Node) => void;\n}\n\nexport default function NodePanel(props: NodePanelProps) {\n  const componnetList = Object.values(ComponentType);\n  const { onDrag, visible = false } = props;\n\n  // 默认取第一个\n  const [collapseKey, setCollapseKey] = useState<string[]>([componnetList[0]]);\n\n  const boxClass = classNames(\"nodePanel-box\", {\n    \"nodePanel-box-visible\": visible\n  });\n\n  /** 处理Collapse展开 */\n  const handleCollapseKey = (items: string[] | string) => {\n    setCollapseKey(items as string[]);\n  };\n\n  const handleDrag = (item: Node) => {\n    if (onDrag) {\n      onDrag(item);\n    }\n  };\n\n  return (\n    <div className=\"nodePanel\">\n      <div className={boxClass}>\n        <div className=\"nodePanel-box-collapse\">\n          <Collapse\n            activeKey={collapseKey}\n            onChange={handleCollapseKey}\n            bordered={true}\n            accordion\n          >\n            {componnetList.map(item => {\n              const total = COMPONENT_CATEGORY[item].length;\n              return (\n                <Panel\n                  key={item}\n                  header={\n                    <div className=\"collapse-title\">{`${\n                      ComponentMap[item]\n                    } (${total})`}</div>\n                  }\n                >\n                  <div className=\"components-box\">\n                    {COMPONENT_CATEGORY[item].map(child => {\n                      const boxItemClass = classNames(\"components-box-item\", {\n                        \"components-box-item-disabled no-drop\": child.disabled\n                      });\n                      return (\n                        <div\n                          className={boxItemClass}\n                          key={child.key}\n                          draggable={true}\n                          onDrag={handleDrag.bind(null, child)}\n                        >\n                          <div className=\"components-box-item-icon\">\n                            {child.icon}\n                          </div>\n                          {/* {child.name} */}\n                        </div>\n                      );\n                    })}\n                  </div>\n                </Panel>\n              );\n            })}\n          </Collapse>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * @file 全屏工具类\n * @author perkinJ\n */\n\n/**\n * 全屏某一个元素\n * @param element\n */\nfunction launchFullscreen(element: any) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  }\n}\n/**\n * 退出全屏\n */\nfunction exitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if ((document as any).webkitExitFullscreen) {\n    (document as any).webkitExitFullscreen();\n  }\n}\n\n/**\n * 判断是否处于全屏状态\n */\nfunction isFull() {\n  const doc = document as any;\n  return doc.fullscreenElement || doc.webkitFullscreenElement;\n}\nexport { launchFullscreen, exitFullscreen, isFull };\n","/**\n * @file 画布操作导航\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport { Icon } from \"antd\";\nimport classNames from \"classnames\";\nimport {\n  launchFullscreen,\n  exitFullscreen,\n  isFull\n} from \"../utils/FullsreenUtils\";\nimport { MIN_SCALE, MAX_SCALE } from \"../defines\";\nimport \"./Toolbar.scss\";\n\n/** 操作面板，支持全屏、缩放、自适应画布、格式化、显示比例 */\n\nexport type ToolbarType =\n  | \"fullscreen\"\n  | \"zoom\"\n  | \"adapt\"\n  | \"format\"\n  | \"ratio\"\n  | \"shear\"\n  | \"copy\"\n  | \"paste\"\n  | \"delete\"\n  | 'dragSelect';\n\nexport class ToolbarProps {\n  /** 适应画布 */\n  handleShowAll?: () => void;\n\n  /** 缩放 */\n  handleResizeTo?: (scale: number) => void;\n\n  /** 改变屏幕缩放大小 */\n  changeScreenScale?: (scale: number) => void;\n\n  /** 缩放大小 */\n  screenScale?: number;\n\n  /** 格式化布局 */\n  layout?: () => void;\n\n  onShear?: () => void;\n\n  onCopy?: () => void;\n\n  onPaste?: () => void;\n\n  onDelete?: () => void;\n\n  onDragSelect?: ()=> void;\n\n  /** 处理全屏 */\n  // handleFullScreen?: () => void;\n  /** Toolbar选项 */\n  items?: ToolbarType[];\n\n  /**  */\n}\n\nconst Toolbar = React.forwardRef((props: ToolbarProps, ref: any) => {\n  const {\n    screenScale,\n    changeScreenScale,\n    handleResizeTo,\n    items,\n    onShear,\n    onCopy,\n    onPaste,\n    onDelete,\n    onDragSelect\n  } = props;\n  const scale = String(Math.round(screenScale));\n\n  /** 是否支持全屏 */\n\n  const isFullScreen = items.includes(\"fullscreen\");\n\n  /** 是否支持缩放 */\n  const isZoom = items.includes(\"zoom\");\n\n  /** 是否支持适应画布 */\n  const isAdapt = items.includes(\"adapt\");\n\n  /** 是否支持格式化 */\n  const isFormat = items.includes(\"format\");\n\n  /** 剪切 */\n  const isShear = items.includes(\"shear\");\n  /** 是否支持复制 */\n  const isCopy = items.includes(\"copy\");\n\n  const isPaste = items.includes(\"paste\");\n\n  const isDelete = items.includes(\"delete\");\n\n  const isDragSelect = items.includes(\"dragSelect\");\n\n  /** 当前是否是全屏状态 */\n\n  const fullscreenStatus = isFull();\n\n  /** 缩放操作 */\n  const handleResize = (isLager?: boolean) => {\n    let value = screenScale;\n    if (isLager) {\n      value = screenScale + 10;\n      if (value > MAX_SCALE) {\n        value = MAX_SCALE;\n      }\n    } else {\n      value = screenScale - 10;\n      if (value < MIN_SCALE) {\n        value = MIN_SCALE;\n      }\n    }\n    handleResizeTo(value / 100);\n    changeScreenScale(value);\n  };\n\n  /** 处理全屏事件 */\n  const handleFullScreen = () => {\n    const isfull = isFull();\n    if (isfull) {\n      exitFullscreen();\n    } else {\n      launchFullscreen(ref.current);\n    }\n  };\n\n  // 渲染按钮\n  const renderButtons = () => {\n    const fullScreenClassName = classNames({\n      fullscreen: !fullscreenStatus,\n      \"fullscreen-exit\": fullscreenStatus\n    });\n\n    return (\n      <>\n        {isZoom && (\n          <>\n            <div className=\"toolbar-btn\">\n              <Icon type=\"zoom-in\" onClick={handleResize.bind(null, true)} />\n            </div>\n            <div className=\"toolbar-btn\">\n              <Icon type=\"zoom-out\" onClick={handleResize.bind(null, false)} />\n            </div>\n          </>\n        )}\n\n        {/* {isAdapt && (\n          <div className=\"adapt\">\n            <Tooltip placement=\"top\" title={I18N.DAG.DAGScreen.adapt}>\n              <Icon\n                type=\"dpicon icon-adapt\"\n                onClick={() => {\n                  props.handleShowAll();\n                }}\n              />\n            </Tooltip>\n          </div>\n        )}\n        {isFormat && (\n          <div className=\"format\">\n            <Tooltip placement=\"top\" title={I18N.PipelineCanvas.utils.format}>\n              <Icon\n                type=\"one-icon icon-geshihuabuju anticon-dpicon\"\n                onClick={() => {\n                  props.layout();\n                }}\n              />\n            </Tooltip>\n          </div>\n        )} */}\n        {isFullScreen && (\n          <div className=\"toolbar-btn\">\n            <Icon type={fullScreenClassName} onClick={handleFullScreen} />\n          </div>\n        )}\n\n        {isShear && (\n          <div className=\"toolbar-btn\">\n            <Icon type=\"scissor\" onClick={onShear} />\n          </div>\n        )}\n\n        {isCopy && (\n          <div className=\"toolbar-btn\">\n            <Icon type=\"copy\" onClick={onCopy} />\n          </div>\n        )}\n\n        {isPaste && (\n          <div className=\"toolbar-btn\">\n            <Icon type=\"snippets\" onClick={onPaste} />\n          </div>\n        )}\n        {isDelete && (\n          <div className=\"toolbar-btn\">\n            <Icon type=\"delete\" onClick={onDelete} />\n          </div>\n        )}\n\n        {isDragSelect && (\n          <div className=\"toolbar-btn\">\n            <Icon type=\"border-outer\" onClick={onDragSelect}/>         \n          </div>\n        )}\n      </>\n    );\n  };\n\n  return (\n    <div className=\"toolbar\">\n      <div className=\"toolbar-scale\">{scale}%</div>\n      <div className=\"toolbar-button\">{renderButtons()}</div>\n    </div>\n  );\n});\n\nexport default Toolbar;\n","/**\n * @file 通用边组件\n * @author perkinJ\n */\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport { CONNECTOR, StyleProps } from \"../utils/types\";\nimport \"./Edge.scss\";\n\nexport interface EdgeProps {\n  /** 元素id，唯一 */\n  id?: string;\n  /** 线条路径 */\n  path?: string;\n  /** 起始端的箭头, 为true时为默认的箭头效果，也可以是一个自定义箭头 */\n  startArrow?: boolean | React.SVGProps<SVGForeignObjectElement>;\n  /** 末尾端的箭头, 为true时为默认的箭头效果，也可以是一个自定义箭头 */\n  endArrow?: boolean | React.SVGProps<SVGForeignObjectElement>;\n  /** 边的击中范围\t */\n  lineAppendWidth?: number;\n  /** 元素样式 */\n  style?: StyleProps;\n  /** 自定义形状 */\n  object?: React.SVGProps<SVGForeignObjectElement>;\n  /** 鼠标点击事件 */\n  onClick?: (event: any) => void;\n  /** 右键事件 */\n  onContextMenu?: (event: any) => void;\n}\n\nexport default function Edge(props: EdgeProps) {\n  const {\n    id,\n    style,\n    onContextMenu,\n    onClick,\n    object,\n    lineAppendWidth,\n    path,\n    startArrow,\n    endArrow\n  } = props;\n  const { fill } = style;\n\n  let markerStart = \"\";\n  if (typeof startArrow === \"boolean\") {\n    if (startArrow) {\n      markerStart = \"url(#flow-startArrow)\";\n    }\n  } else if (React.isValidElement(startArrow)) {\n    markerStart = `url(#${(startArrow.props as any).id})`;\n  }\n\n  let endStart = \"\";\n  if (typeof endArrow === \"boolean\") {\n    if (startArrow) {\n      endStart = \"url(#flow-startArrow)\";\n    }\n  } else if (React.isValidElement(endArrow)) {\n    endStart = `url(#${(endArrow.props as any).id})`;\n  }\n\n  return (\n    <g key={`${id}${CONNECTOR}`} className=\"editor-link\">\n      <defs>\n        {React.isValidElement(startArrow) ? (\n          React.cloneElement(startArrow)\n        ) : (\n          <marker\n            id=\"flow-startArrow\"\n            markerWidth=\"10\"\n            markerHeight=\"10\"\n            refX=\"0\"\n            refY=\"2\"\n            orient=\"auto\"\n            markerUnits=\"strokeWidth\"\n          >\n            <path d=\"M0,0 L0,4 L4,2 z\" fill={fill} />\n          </marker>\n        )}\n      </defs>\n      <defs>\n        {React.isValidElement(endArrow) ? (\n          React.cloneElement(endArrow)\n        ) : (\n          <marker\n            id=\"flow-endArrow\"\n            markerWidth=\"10\"\n            markerHeight=\"10\"\n            refX=\"0\"\n            refY=\"2\"\n            orient=\"auto\"\n            markerUnits=\"strokeWidth\"\n          >\n            <path d=\"M0,0 L0,4 L4,2 z\" fill={fill} />\n          </marker>\n        )}\n      </defs>\n      <path\n        key={id}\n        className=\"editor-link-path\"\n        stroke={_.get(style, \"stroke\", \"\")}\n        strokeWidth={_.get(style, \"strokeWidth\", 0)}\n        d={path}\n        markerStart={markerStart}\n        markerEnd={endStart}\n      />\n      {/** 这里增加一个虚拟背景，增加连线的两边可点击区域，提高用户体验 */}\n      <path\n        key={`${id}-background`}\n        className=\"editor-link-path editor-link-path-background\"\n        style={{ strokeWidth: lineAppendWidth }}\n        d={path}\n        onContextMenu={onContextMenu}\n        onClick={onClick}\n      />\n      <g>{object}</g>\n    </g>\n  );\n}\n","/**\n * @file 公共类型定义文件\n * @author perkinJ\n */\n\n// 连接符\nexport const CONNECTOR = '_';\n\n// 点坐标\nexport class Point {\n  x: number;\n\n  y: number;\n}\n\n// 节点支持的形状\nexport type Shape = 'rect' | 'circle' | 'ellipse' | 'poly';\n\n// 方向\nexport type Direction = 'left' | 'right';\n\n// 圈选器节点属性\nexport class ShapeProps {\n  x: number;\n\n  y: number;\n\n  width: number;\n\n  height: number;\n\n  direction: Direction;\n}\n\n// 通用svg元素样式\nexport class StyleProps {\n  /** 填充色 */\n  fill?: string;\n\n  /** 边框宽度 */\n  strokeWidth?: number;\n\n  /** 颜色 */\n  stroke?: string;\n\n  /** 虚线间隔 */\n  strokeDasharray?: string;\n}\n","/**\n * @file 通用节点组件\n * @desc 与画布联动，用于计算画布位置、缩放等\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport { useResize } from \"../hooks/useResize\";\nimport \"./Node.scss\";\n\nconst { useRef, useState, useEffect, useCallback } = React;\n\nclass NodeProps {\n  /** 节点id */\n  id: string;\n\n  /** 节点横坐标 */\n  x: number;\n\n  /** 节点纵坐标 */\n  y: number;\n\n  width: number;\n\n  height: number;\n\n  /** 点击节点 */\n  onClick?: (event) => void;\n\n  /** ContextMenu */\n  onContextMenu?: (position: any, event) => void;\n\n  /** 当前节点信息 */\n  node?: any;\n\n  /** 外部画布属性 */\n  currTrans?: any;\n\n  /** 是否被点击 */\n  isSelected: boolean;\n\n  children?: React.ReactNode;\n\n  /** 改变节点大小 */\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n}\n\n/**\n * 获取元素相对于页面的绝对位置\n */\nexport function getOffset(domNode: any) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n  let targetDomNode = domNode;\n  while (targetDomNode !== window.document.body && targetDomNode != null) {\n    offsetLeft += targetDomNode.offsetLeft;\n    offsetTop += targetDomNode.offsetTop;\n    targetDomNode = targetDomNode.offsetParent;\n  }\n  return {\n    offsetTop,\n    offsetLeft\n  };\n}\n\nconst Node = React.forwardRef((props: NodeProps, ref: any) => {\n  const {\n    x,\n    y,\n    id,\n    onClick,\n    onContextMenu,\n    children,\n    currTrans,\n    width,\n    height,\n    isSelected,\n    onResize\n  } = props;\n\n  const [showSelector, setShowSelector] = useState(false);\n  const containerRef = useRef(null);\n\n  // 获取伸缩的大小\n  const {\n    width: resizeWidth,\n    height: resizeHeight,\n    x: resizeX,\n    y: resizeY\n  } = useResize(isSelected, {\n    width,\n    height,\n    x,\n    y\n  });\n\n  const handleContextMenu = (event: React.MouseEvent<any>) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const container = containerRef.current.getBoundingClientRect();\n    container.id = id;\n    const { offsetTop, offsetLeft } = getOffset(container.current);\n\n    // The position ⟨x,y⟩ is transformed to ⟨xk + tx,yk + ty⟩\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    const newX = (screenX - x) / currTrans.k;\n    const newY = (screenY - y) / currTrans.k;\n\n    const currentPos = {\n      left: newX,\n      top: newY\n    };\n\n    if (onContextMenu) {\n      onContextMenu(currentPos, event);\n    }\n  };\n\n  const NODE_SELECTOR = [\n    {\n      position: \"left\",\n      style: { left: \"-5px\", top: `${height / 2 - 5}px` }\n    },\n    {\n      position: \"right\",\n      style: { right: \"-5px\", top: `${height / 2 - 5}px` }\n    },\n    {\n      position: \"top\",\n      style: { left: `${width / 2 - 5}px`, top: \"-5px\" }\n    },\n    {\n      position: \"bottom\",\n      style: { left: `${width / 2 - 5}px`, top: `${height - 5}px` }\n    }\n  ];\n\n  const RESIZE_SELECTOR = [\n    \"top-left\",\n    \"top-right\",\n    \"bottom-left\",\n    \"bottom-right\"\n  ];\n\n  // 伸缩器\n  const renderResize = (\n    <div className=\"resizable\">\n      <div className=\"resizers\">\n        {RESIZE_SELECTOR.map(item => (\n          <div key={item} className={`resizer ${item}`} data-type=\"resize\" />\n        ))}\n      </div>\n    </div>\n  );\n\n  // 连线节点选择器\n  const renderNodeSelector = (\n    <div className=\"editor-node-selector\" style={{ width, height }}>\n      {NODE_SELECTOR.map(item => {\n        return (\n          <a\n            data-type=\"edge\"\n            data-position={item.position}\n            key={item.position}\n            className={`node-selector`}\n            style={item.style}\n          />\n        );\n      })}\n    </div>\n  );\n\n  useEffect(() => {\n    onResize(resizeWidth, resizeHeight, resizeX, resizeY);\n  }, [resizeWidth, resizeHeight, resizeX, resizeY]);\n\n  return (\n    <div\n      className=\"editor-node\"\n      style={{\n        left: x,\n        top: y,\n        width,\n        height\n      }}\n      ref={ref}\n      onClick={onClick}\n      onMouseEnter={() => setShowSelector(true)}\n      onMouseLeave={() => setShowSelector(false)}\n      onContextMenu={handleContextMenu}\n    >\n      {(isSelected || showSelector) && renderNodeSelector}\n      {isSelected && renderResize}\n      {React.cloneElement(children as React.ReactElement<any>, {\n        ref: containerRef\n      })}\n    </div>\n  );\n});\n\nexport default Node;\n","import { useState, useEffect } from 'react';\n\nclass NodeInfo {\n  width: number;\n  height: number;\n  x: number;\n  y: number;\n}\n\nconst useResize = (isResize: boolean, { width, height, x, y }: NodeInfo): NodeInfo => {\n  const [nodeWidth, setNodeWidth] = useState(width);\n  const [nodeHeight, setNodeHeight] = useState(height);\n  const [nodeLeft, setNodeLeft] = useState(x);\n  const [nodeTop, setNodeTop] = useState(y);\n\n  useEffect(() => {\n    setNodeLeft(x);\n    setNodeTop(y);\n  }, [x, y]);\n\n  useEffect(() => {\n    const resizers = document.querySelectorAll('.resizer');\n    const element = document.querySelector('.resizable');\n    const minSize = 20;\n    // 初始高度宽度\n    let originWidth = 0;\n    let originHeight = 0;\n    // 节点的初始位置\n    let originX = 0;\n    let originY = 0;\n    // 鼠标拖拽的初始位置\n    let originMouseX = 0;\n    let originMouseY = 0;\n    if (isResize) {\n      for (let i = 0; i < resizers.length; i++) {\n        const currentResizer = resizers[i];\n        currentResizer.addEventListener('mousedown', e => {\n          e.preventDefault();\n\n          originWidth = parseFloat(\n            getComputedStyle(element, null)\n              .getPropertyValue('width')\n              .replace('px', '')\n          );\n          originHeight = parseFloat(\n            getComputedStyle(element, null)\n              .getPropertyValue('height')\n              .replace('px', '')\n          );\n          originX = element.getBoundingClientRect().left;\n          originY = element.getBoundingClientRect().top;\n          originMouseX = (e as any).pageX;\n          originMouseY = (e as any).pageY;\n\n          // 变更type\n          window.addEventListener('mousemove', resize);\n          window.addEventListener('mouseup', stopResize);\n        });\n        const resize = e => {\n          let newWidth = 0;\n          let newHeight = 0;\n          let newLeft = 0;\n\n          if (currentResizer.classList.contains('bottom-right')) {\n            newWidth = originWidth + (e.pageX - originMouseX);\n            newHeight = originHeight + (e.pageY - originMouseY);\n            if (newWidth > minSize) {\n              setNodeWidth(newWidth);\n            }\n            if (newHeight > minSize) {\n              setNodeHeight(newHeight);\n            }\n          } else if (currentResizer.classList.contains('bottom-left')) {\n            newWidth = originWidth - (e.pageX - originMouseX);\n            newHeight = originHeight + (e.pageY - originMouseY);\n            if (newWidth > minSize) {\n              setNodeWidth(newWidth);\n              setNodeLeft(nodeLeft + (e.pageX - originMouseX));\n            }\n            if (newHeight > minSize) {\n              setNodeHeight(newHeight);\n            }\n          } else if (currentResizer.classList.contains('top-right')) {\n            newWidth = originWidth + (e.pageX - originMouseX);\n            newHeight = originHeight - (e.pageY - originMouseY);\n            if (newWidth > minSize) {\n              setNodeWidth(newWidth);\n            }\n            if (newHeight > minSize) {\n              setNodeHeight(newHeight);\n              setNodeTop(nodeTop + (e.pageY - originMouseY));\n            }\n          } else {\n            newWidth = originWidth - (e.pageX - originMouseX);\n            newHeight = originHeight - (e.pageY - originMouseY);\n            if (width > minSize) {\n              setNodeWidth(newWidth);\n              setNodeLeft(nodeLeft + (e.pageX - originMouseX));\n            }\n            if (height > minSize) {\n              setNodeHeight(newHeight);\n              setNodeTop(nodeTop + (e.pageY - originMouseY));\n            }\n          }\n        };\n\n        const stopResize = () => {\n          window.removeEventListener('mousemove', resize);\n        };\n      }\n    }\n  }, [isResize, nodeWidth, nodeHeight, setNodeHeight, setNodeWidth, nodeTop, nodeLeft, setNodeTop, setNodeLeft]);\n\n  return {\n    width: nodeWidth,\n    height: nodeHeight,\n    x: nodeLeft,\n    y: nodeTop\n  };\n};\n\nexport { useResize };\n","/**\n * @file 画布底层位置计算相关方法\n * @author 剑决(perkin.pj)\n */\n\nimport * as _ from \"lodash\";\nimport { Point, Shape, ShapeProps } from \"./types\";\n/**\n * 两点间直线距离\n * @param sourcePoint\n * @param targetPoint\n */\nexport function distance(sourcePoint: Point, targetPoint: Point) {\n  const x = sourcePoint.x - targetPoint.x;\n  const y = sourcePoint.y - targetPoint.y;\n  return Math.sqrt(x * x + y * y);\n}\n\n/**\n * 两点间曲线\n * @param sourcePoint\n * @param targetPoint\n */\nexport const quadratic = (sourcePoint: Point, targetPoint: Point): string => {\n  const ratio = detectZoom();\n  const sourceX = sourcePoint.x * ratio;\n  const targetX = targetPoint.x * ratio;\n\n  const centerX = (sourceX + targetX) / 2;\n  const centerY = (sourcePoint.y + targetPoint.y) / 2;\n  let tolerance = 30;\n\n  const sub = targetPoint.y - sourcePoint.y;\n\n  if (sub > -100 && sub < 100) {\n    tolerance = Math.max(Math.abs(targetPoint.y - sourcePoint.y) / 2, 20);\n  }\n\n  return [\n    \"M\",\n    sourceX,\n    sourcePoint.y,\n    \"Q\",\n    /** 横向与竖向有区别 */\n    sourceX + tolerance,\n    sourcePoint.y,\n    centerX,\n    centerY,\n    \"T\",\n    targetX - 6,\n    targetPoint.y - 2\n  ].join(\" \");\n};\n\n/**\n * 计算屏幕缩放比例\n */\nexport function detectZoom() {\n  let ratio = window.outerWidth / window.innerWidth;\n  const screen = window.screen;\n  const ua = navigator.userAgent.toLowerCase();\n\n  if (window.devicePixelRatio !== undefined) {\n    // 由于mac retina屏幕devicePixelRatio会扩大2倍，这里mac统一用window.outerWidth / window.innerWidth表示ratio\n    const isMac = /macintosh|mac os x/i.test(ua);\n\n    ratio = isMac\n      ? window.outerWidth / window.innerWidth\n      : window.devicePixelRatio;\n  } else if (ua.indexOf(\"msie\") > -1) {\n    if ((screen as any).deviceXDPI && (screen as any).logicalXDPI) {\n      ratio = (screen as any).deviceXDPI / (screen as any).logicalXDPI;\n    }\n  } else if (\n    window.outerWidth !== undefined &&\n    window.innerWidth !== undefined\n  ) {\n    ratio = window.outerWidth / window.innerWidth;\n  }\n\n  if (ratio) {\n    ratio = Math.round(ratio * 100) / 100;\n  }\n\n  return ratio;\n}\n\n/**\n * 获取元素相对于页面的绝对位置\n */\nexport function getOffset(domNode: any, parentElem = window.document.body) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n  let targetDomNode = domNode;\n  const ratio = detectZoom();\n  while (targetDomNode !== parentElem && targetDomNode != null) {\n    offsetLeft += targetDomNode.offsetLeft;\n    offsetTop += targetDomNode.offsetTop;\n    targetDomNode = targetDomNode.offsetParent;\n  }\n  return {\n    offsetTop,\n    offsetLeft\n  };\n}\n\n/** 获取元素在页面上占据的高度 */\nexport function getHeight(dom: HTMLElement) {\n  if (!dom) {\n    return 0;\n  }\n  const style = window.getComputedStyle(dom);\n  return (\n    dom.getBoundingClientRect().height +\n    Number(style.marginTop.match(/\\d+/g)) +\n    Number(style.marginBottom.match(/\\d+/g))\n  );\n}\n\n// 获取元素在页面上占据的宽度\nexport function getWidth(dom: HTMLElement) {\n  if (!dom) {\n    return 0;\n  }\n  const style = window.getComputedStyle(dom);\n  return (\n    dom.getBoundingClientRect().width +\n    Number(style.marginLeft.match(/\\d+/g)) +\n    Number(style.marginRight.match(/\\d+/g))\n  );\n}\n\n/** 获取元素在页面的绝对位置 */\nexport function getPosition(dom: HTMLElement) {\n  if (!dom) {\n    return 0;\n  }\n  return {\n    x: dom.getBoundingClientRect().x,\n    y: dom.getBoundingClientRect().y\n  };\n}\n\nexport function calcLinkPosition(node, position) {\n  let x = node?.x + node?.width;\n  let y = node?.y + node?.height / 2;\n  if (position === \"left\") {\n    x = node?.x;\n    y = node?.y + node?.height / 2;\n  } else if (position === \"right\") {\n    x = node?.x + node?.width;\n    y = node?.y + node?.height / 2;\n  } else if (position === \"top\") {\n    x = node?.x + node?.width / 2;\n    y = node?.y;\n  } else if (position === \"bottom\") {\n    x = node?.x + node?.width / 2;\n    y = node?.y + node?.height;\n  }\n\n  return {\n    x,\n    y\n  };\n}\n\n// 处理不同图形的path数据\nexport function handlePathData(shape: Shape, shapeProps: ShapeProps): string {\n  const { x, y, width, height, direction } = shapeProps;\n  let pathData = \"\";\n  if (shape === \"rect\") {\n    pathData = `M${x} ${y} h ${width} v ${height} h -${width} Z`;\n    if (direction === \"right\") {\n      pathData = `M${x} ${y} h -${width} v -${height} h ${width} Z`;\n    }\n  }\n  return pathData;\n}\n","/**\n * @file 圈选器逻辑处理，与视图分离\n * @author perkinJ\n */\n\nimport * as React from 'react';\n\nimport { handlePathData } from './calc';\nimport { Shape, ShapeProps } from './types';\n\nconst { useCallback, useEffect, useState, useRef } = React;\n\nconst initSelectorProps = {\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n  direction: 'left',\n} as ShapeProps;\n\nexport default function useDragSelect(dragSelectContainerRef: any, shape: Shape) {\n  const [shapeProps, setShapeProps] = useState<ShapeProps>(initSelectorProps);\n\n  const [pathData, setPathData] = useState('');\n\n  // 记录mousedown事件的X,Y位置，\n  const mousdownX = useRef(0);\n  const mousdownY = useRef(0);\n\n  const handleMouseMove = useCallback(\n    event => {\n      const newX = event.layerX;\n      const newY = event.layerY;\n      const newWidth = Math.abs(newX - mousdownX.current);\n      const newHeight = Math.abs(newY - mousdownY.current);\n\n      const diffX = newX - mousdownX.current;\n\n      const newShapeProps = {\n        x: mousdownX.current,\n        y: mousdownY.current,\n        width: newWidth,\n        height: newHeight,\n        direction: diffX < 0 ? 'right' : 'left',\n      } as ShapeProps;\n\n      const path = handlePathData(shape, newShapeProps);\n      setPathData(path);\n      setShapeProps(newShapeProps);\n    },\n    [setShapeProps, shape],\n  );\n\n  const handleMouseUp = useCallback(\n    event => {\n      event.stopPropagation();\n\n      // 清空路径\n      setPathData('');\n\n      // 清空初次点击数据\n      mousdownX.current = 0;\n      mousdownY.current = 0;\n      dragSelectContainerRef.current.removeEventListener('mousemove', handleMouseMove);\n    },\n    [dragSelectContainerRef, handleMouseMove],\n  );\n\n  const handleMouseDown = useCallback(\n    event => {\n      event.stopPropagation();\n\n      mousdownX.current = event.layerX;\n      mousdownY.current = event.layerY;\n\n      dragSelectContainerRef.current.addEventListener('mousemove', handleMouseMove);\n      dragSelectContainerRef.current.addEventListener('mouseup', handleMouseUp);\n    },\n    [dragSelectContainerRef, handleMouseMove, handleMouseUp],\n  );\n\n  useEffect(() => {\n    const drag = dragSelectContainerRef.current;\n    drag.addEventListener('mousedown', handleMouseDown);\n    return () => {\n      drag.removeEventListener('mousedown', handleMouseDown);\n    };\n  }, [dragSelectContainerRef, handleMouseDown]);\n\n  // 返回选择器坐标位置以及生成的path数据\n  return { shapeProps, pathData };\n}\n\nexport { ShapeProps };\n","/**\n * @file 圈选器组件\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport classNames from \"classnames\";\nimport * as _ from \"lodash\";\nimport useDragSelect, { ShapeProps } from \"../utils/useDragSelect\";\nimport { StyleProps } from \"../utils/types\";\nimport { getHeight, getWidth, getPosition } from \"../utils/calc\";\n\nimport \"./DragSelector.scss\";\n\nconst { useRef, useCallback, useMemo } = React;\n\nclass DragSeletorProps {\n  /** 蒙层的颜色 */\n  overlayColor?: string;\n\n  /** 选择器的样式 */\n  selectorStyle?: StyleProps;\n\n  /** 是否展示 */\n  visible: boolean;\n\n  /** 关闭 */\n  onClose?: (selectProps: ShapeProps) => void;\n\n  /** 挂载在DOM节点下 */\n  getPopupContainer?: () => HTMLElement;\n}\n\nexport default function DragSeletor(props: DragSeletorProps) {\n  const {\n    // width,\n    // height,\n    overlayColor,\n    selectorStyle,\n    visible,\n    onClose,\n    getPopupContainer\n  } = props;\n  const dragSelectContainerRef = useRef(null);\n\n  const { shapeProps, pathData } = useDragSelect(\n    dragSelectContainerRef,\n    \"rect\"\n  );\n\n  const handleClick = useCallback(\n    event => {\n      event.stopPropagation();\n      event.preventDefault();\n      if (onClose) {\n        onClose(shapeProps);\n      }\n    },\n    [onClose, shapeProps]\n  );\n\n  return useMemo(() => {\n    const classes = classNames(\"drag-select-container\", {\n      \"drag-select-hidden\": !visible\n    });\n\n    const popupContainer = getPopupContainer() as HTMLElement;\n    const width = getWidth(popupContainer);\n    const height = getHeight(popupContainer);\n    const position = getPosition(popupContainer) as { x: number; y: number };\n\n    return (\n      <svg\n        ref={dragSelectContainerRef}\n        className={classes}\n        width={width}\n        height={height}\n        style={{\n          background: overlayColor,\n          left: position?.x,\n          top: position?.y\n        }}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        onDrag={event => {\n          event.preventDefault();\n        }}\n        onClick={handleClick}\n      >\n        <g>\n          {/** 可支持多个图形，矩形，圆形，自定义路径等 */}\n          <path d={pathData} style={{ ...selectorStyle }} />\n        </g>\n      </svg>\n    );\n  }, [overlayColor, handleClick, selectorStyle, visible, pathData]);\n}\n\nexport { ShapeProps };\n","import * as React from 'react';\n\nimport './ContextMenu.scss';\n\nclass ContextMenuProps {\n  id?: string;\n  visible: boolean;\n  left: number;\n  top: number;\n  // onHide: () => void;\n  children: any;\n}\nconst ContextMenu: React.FC<ContextMenuProps> = (props: ContextMenuProps) => {\n  const { id, visible, left, top, children } = props;\n  return (\n    <div\n      id={id ? `context-menu-${id}` : 'context-menu'}\n      style={{ display: visible ? 'block' : 'none', left, top }}\n      className=\"contextMenu-layer\">\n      <div className=\"contextMenu\">{children}</div>\n    </div>\n  );\n};\n\nexport { ContextMenu };\n","import { MutableRefObject, useRef, useEffect, useCallback, useMemo } from 'react';\n\n// 鼠标点击事件，click 不会监听右键\nconst defaultEvent = 'click';\n\ntype RefType = HTMLElement | (() => HTMLElement | null) | null;\n\nexport function useClickAway<T extends HTMLElement = HTMLDivElement>(\n  onClickAway: (event: KeyboardEvent) => void,\n  dom?: RefType,\n  eventName: string = defaultEvent,\n): MutableRefObject<T> {\n  const element = useRef<T>();\n\n  const handler = useCallback(\n    event => {\n      const targetElement = typeof dom === 'function' ? dom() : dom;\n      const el = targetElement || element.current;\n      if (!el || el.contains(event.target)) {\n        return;\n      }\n\n      onClickAway(event);\n    },\n    [element.current, onClickAway, dom],\n  );\n\n  useEffect(() => {\n    document.addEventListener(eventName, handler);\n\n    return () => {\n      document.removeEventListener(eventName, handler);\n    };\n  }, [eventName, handler]);\n\n  return element as MutableRefObject<T>;\n}","/**\n * @file 业务组件，基于Node的管道组件卡片\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport classNames from \"classnames\";\nimport { Menu } from \"antd\";\nimport { Node as NodeContainer } from \"./components\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport { Node, OperateType } from \"./defines\";\nimport { useClickAway } from \"./hooks/useClickAway\";\nimport \"./EditorNode.scss\";\n\nconst { useState, useRef, useMemo, useCallback } = React;\n\nclass EditorNodeProps {\n  /** 唯一id，用于Contextmenu展示 */\n  id?: string;\n\n  /** 节点信息 */\n  currentNode: Node;\n\n  /** 选择菜单栏 */\n  onSelect?: (currentNode: Node, key: any) => void;\n\n  /** 右键组件 */\n  onContextMenu?: (event: React.MouseEvent<HTMLLIElement>) => void;\n\n  /** 是否属性设置完全 */\n  isCompleted?: boolean;\n\n  /** 是否有错误数据 */\n  hasError?: boolean;\n\n  /** 是否被点击 */\n  isSelected?: boolean;\n\n  /** 是否被拖拽 */\n  isDragged?: boolean;\n\n  /** 点击卡片 */\n  onClick?: (currentNode: Node, event: any) => void;\n\n  /** 是否可交互，区分展示型和交互型 */\n  interactive?: boolean;\n\n  /** 外部容器的缩放情况 */\n  currTrans?: any;\n\n  /** 显示选择器 */\n  showSelector?: boolean;\n\n  /** Node容器的ref */\n  nodeRef: any;\n\n  /** 改变节点大小 */\n  onResize?: (width: number, height: number, x: number, y: number) => void;\n}\n\n/**\n * 获取元素相对于页面的绝对位置\n */\nexport function getOffset(domNode: any) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n  let targetDomNode = domNode;\n  while (targetDomNode !== window.document.body && targetDomNode != null) {\n    offsetLeft += targetDomNode.offsetLeft;\n    offsetTop += targetDomNode.offsetTop;\n    targetDomNode = targetDomNode.offsetParent;\n  }\n  return {\n    offsetTop,\n    offsetLeft\n  };\n}\n\nexport function EditorNode(props: EditorNodeProps) {\n  const {\n    currentNode,\n    onSelect,\n    hasError,\n    isSelected,\n    isDragged,\n    onClick,\n    interactive = true,\n    currTrans,\n    nodeRef,\n    onResize,\n    showSelector,\n    id\n  } = props;\n  // 组件内状态，与业务无关\n  const [menuShow, setMenuShow] = useState(false);\n  const [menuPos, setMenuPos] = useState({ left: 0, top: 0 });\n\n  useClickAway(\n    () => {\n      setMenuShow(false);\n    },\n    () => document.querySelector(\".editorNode-box-menu\"),\n    \"contextmenu\"\n  );\n\n  const menuRef = useClickAway(() => {\n    setMenuShow(false);\n  });\n\n  const editorNodeRef = useRef(null);\n\n  // const [pos, setPos] = useState(initPos);\n  // 边框颜色\n  let borderColor = \"\";\n  if (isSelected) {\n    borderColor = `selected ${currentNode.key}-clicked ${\n      currentNode.key\n    }-border`;\n  } else {\n    borderColor = `${currentNode.key}-border`;\n  }\n\n  // 是否是圆形\n  const isCircle = currentNode.key === \"circle\";\n\n  // 是否为圆角\n  const isRadius = currentNode.key === 'rectRadius';\n\n  // 是否为菱形\n  const isDiamond = currentNode.key === 'diamond';\n\n  const borderClass = classNames(\n    \"editorNode-box\",\n    borderColor,\n    {\n      dragging: isDragged\n    },\n    { \"editorNode-circle\": isCircle },\n    { \"editorNode-rectRadius\": isRadius},\n  );\n\n  const menuList = [\n    {\n      name: \"删除\",\n      key: OperateType.delete,\n      disabled: false\n    }\n  ];\n\n  const onContextMenu = (\n    position: { left: number; top: number },\n    event: React.MouseEvent<any>\n  ) => {\n    event.stopPropagation();\n    event.preventDefault();\n    // 根据业务场景处理菜单的位置\n    const newPosition = {\n      left: position.left,\n      top: position.top\n    };\n    setMenuPos(newPosition);\n    setMenuShow(true);\n    if (props.onContextMenu) {\n      props.onContextMenu(event);\n    }\n  };\n\n  /** 点击菜单项 */\n  const handleClickMenu = ({ key }) => {\n    onSelect(currentNode, key);\n    setMenuShow(false);\n  };\n\n  /** 点击组件 */\n  const handleClickNode = useCallback(\n    event => {\n      if (interactive && onClick) {\n        onClick(currentNode, event);\n      }\n    },\n    [interactive, onClick, currentNode]\n  );\n\n  return (\n    <NodeContainer\n      id={currentNode.id}\n      x={currentNode.x}\n      y={currentNode.y}\n      width={currentNode.width}\n      height={currentNode.height}\n      currTrans={currTrans}\n      ref={nodeRef}\n      isSelected={isSelected}\n      onClick={handleClickNode}\n      onResize={onResize}\n      onContextMenu={interactive ? onContextMenu : null}\n    >\n      <div className=\"editorNode\" ref={editorNodeRef}>\n        <div className={borderClass} style={ { transform: isDiamond?`rotateZ(45deg) skew(30deg,30deg)`: 'none'}}>\n          <div className=\"editorNode-box-property\">\n            <div className=\"editorNode-name\">{currentNode.name}</div>\n          </div>\n          <div className=\"editorNode-box-menu\" ref={menuRef}>\n            <ContextMenu\n              id={currentNode.id}\n              visible={menuShow}\n              left={menuPos.left}\n              top={menuPos.top}\n            >\n              <Menu\n                getPopupContainer={(triggerNode: any) => triggerNode.parentNode}\n              >\n                {menuList.map(child => {\n                  return (\n                    <Menu.Item key={child.key} onClick={handleClickMenu}>\n                      {child.name}\n                    </Menu.Item>\n                  );\n                })}\n              </Menu>\n            </ContextMenu>\n          </div>\n        </div>\n      </div>\n    </NodeContainer>\n  );\n}\n","/**\n * @file 通用边组件\n * @author perkinJ\n */\n\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport Edge from \"./components/Edge\";\nimport { quadratic, calcLinkPosition } from \"./utils/calc\";\nimport { Node, Link, ACTIVE, LINK, UNLINK } from \"./defines\";\nimport \"./EditorEdges.scss\";\n\nclass EditorEdgesProps {\n  /** 唯一id */\n  id?: string;\n\n  /** 边 */\n  links: Link[];\n\n  /** 节点 */\n  nodes: Node[];\n\n  /** 被点击的连线 */\n  selectedLinks?: string[];\n\n  /** 选择某条线 */\n  onSelectLink?: (\n    key: string,\n    event: React.MouseEvent<SVGPathElement, MouseEvent>\n  ) => void;\n\n  /** 右键某条线 */\n  onContextMenu?: (\n    key: string,\n    event: React.MouseEvent<SVGPathElement, MouseEvent>\n  ) => void;\n\n  /** 是否连线 */\n  isDraggingLink?: boolean;\n\n  /** 拖拽连线属性 */\n  dragLink?: {\n    /** 源起节点id */\n    originId: string;\n    /** 源起节点 */\n    originX: number;\n    originY: number;\n    /** 鼠标移动节点 */\n    x: number;\n    y: number;\n  };\n\n  /** 是否可交互 */\n  interactive?: boolean;\n}\n\nexport function EditorEdges(props: EditorEdgesProps) {\n  const {\n    links,\n    nodes,\n    selectedLinks,\n    onSelectLink,\n    onContextMenu,\n    isDraggingLink,\n    dragLink,\n    interactive = true\n  } = props;\n  const edgesPath = links.map(link => {\n    const { source, target, id, sourcePos, targetPos } = link;\n    const uNode = _.find(nodes, vertex => {\n      return vertex.id === source;\n    });\n    const vNode = _.find(nodes, vertex => {\n      return vertex.id === target;\n    });\n    const { x: sourceX, y: sourceY } = calcLinkPosition(uNode, sourcePos);\n    const { x: targetX, y: targetY } = calcLinkPosition(vNode, targetPos);\n\n    // 自定义路径\n    const pathData = quadratic(\n      {\n        x: sourceX,\n        y: sourceY\n      },\n      {\n        x: targetX,\n        y: targetY\n      }\n    );\n\n    // 连线的中点\n    // const centerX = (uNode.x + NODE_WIDTH + vNode.x) / 2;\n    // const centerY = (uNode.y + NODE_HEIGHT + vNode.y) / 2;\n\n    const isActive = selectedLinks ? selectedLinks.includes(id) : false;\n    const fill = isActive ? ACTIVE : LINK;\n\n    const style = {\n      fill,\n      stroke: fill,\n      strokeWidth: 2\n    };\n\n    return (\n      <Edge\n        key={id}\n        id={id}\n        path={pathData}\n        lineAppendWidth={15}\n        style={style}\n        onContextMenu={interactive ? onContextMenu.bind(null, id) : null}\n        onClick={interactive ? onSelectLink.bind(null, id) : null}\n        endArrow={\n          <marker\n            id={`${id}-endArrow`}\n            markerWidth=\"10\"\n            markerHeight=\"10\"\n            refX=\"0\"\n            refY=\"2\"\n            orient=\"auto\"\n            markerUnits=\"strokeWidth\"\n          >\n            <path d=\"M0,0 L0,4 L4,2 z\" fill={fill} />\n          </marker>\n        }\n        // object={\n        //   (type || _.isBoolean(sendTo)) &&\n        //   !iconDisabled && (\n        //     <foreignObject\n        //       width={LINKICON_WIDTH}\n        //       height=\"60\"\n        //       x={centerX - LINKICON_WIDTH / 2}\n        //       y={centerY - LINKICON_HEIGHT / 2}\n        //     >\n        //       <div className=\"link-icon\">\n\n        //       </div>\n        //     </foreignObject>\n        //   )\n        // }\n      />\n    );\n  });\n\n  const renderDraggingLink = () => {\n    if (isDraggingLink) {\n      const { x, y, originX, originY } = dragLink;\n      const pathData = quadratic(\n        {\n          x: originX,\n          y: originY\n        },\n        {\n          x,\n          y\n        }\n      );\n\n      return (\n        <Edge\n          path={pathData}\n          endArrow={\n            <marker\n              id={`${UNLINK}-endArrow`}\n              markerWidth=\"10\"\n              markerHeight=\"10\"\n              refX=\"0\"\n              refY=\"2\"\n              orient=\"auto\"\n              markerUnits=\"strokeWidth\"\n            >\n              <path d=\"M0,0 L0,4 L4,2 z\" fill={UNLINK} />\n            </marker>\n          }\n          style={{\n            fill: UNLINK,\n            stroke: UNLINK,\n            strokeWidth: 2\n          }}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <svg className=\"editor-view-svg\">\n      {links && edgesPath}\n      {interactive && renderDraggingLink()}\n    </svg>\n  );\n}\n","/**\n * @file 节点，边搜索方法\n * @author perkinJ\n */\n\nimport * as _ from 'lodash';\nimport { Node, Link } from '../defines';\nimport { distance } from './calc';\nimport { Point } from './types';\n/**\n * 查找单个上游组件\n */\nexport const findUpstreamNode = (id: string, nodes: Node[], links: Link[]) => {\n  const selectedLinks = _.find(links, item => item.target === id);\n  if (selectedLinks) {\n    const upstreamComponent = _.find(nodes, item => item.id === selectedLinks.source, null);\n    return upstreamComponent;\n  }\n};\n\n/**\n * 查找单个下游组件\n */\nexport const findDownstreamNode = (id: string, nodes: Node[], links: Link[]) => {\n  const selectedLinks = _.find(links, item => item.source === id);\n  if (selectedLinks) {\n    const downstreamComponent = _.find(nodes, item => item.id === selectedLinks.target, null);\n    return downstreamComponent;\n  }\n};\n\n/** 搜索当前组件的所有的下游组件 */\nexport const findAllDownstreamNodes = (id: string, nodes: Node[], links: Link[]) => {\n  const selectedLinks = _.filter(links, item => item.source === id);\n  if (Array.isArray(selectedLinks) && selectedLinks.length > 0) {\n    const downstreamComponent = selectedLinks.map(link => _.find(nodes, item => item.id === link.target));\n    return downstreamComponent;\n  }\n  return [];\n};\n\n/** 搜索所有的上游组件 */\nexport const findAllUpstreamNodes = (id: string, nodes: Node[], links: Link[]) => {\n  const selectedLinks = _.filter(links, item => item.target === id);\n  if (selectedLinks) {\n    const upstreamComponent = _.filter(nodes, item => item.id === selectedLinks[0].source);\n    return upstreamComponent;\n  }\n  return [];\n};\n\n/** 搜索当前组件的所有上游连线 */\nexport const findAllUptreamLinks = (id: string, links: Link[]) => {\n  const newLinks = _.filter(links, item => item.target === id);\n  return newLinks;\n};\n\n/** 搜索当前组件的所有下游连线 */\nexport const findAllDownstreamLinks = (id: string, links: Link[]) => {\n  const newLinks = _.filter(links, item => item.source === id);\n  return newLinks;\n};\n\n/**\n * @desc 查找靠近某个点最近的节点，用于连线\n * @param point 点的坐标\n * @param nodes 节点\n * @param range 最大范围\n */\nexport const findNearbyNode = (point: Point, nodes: Node[], range: number) => {\n  let targetNode: Node = null;\n  let minDis = Infinity;\n  let targetPos = '';\n\n  nodes.forEach(v => {\n    // 1. 比较4个点离初始点最近的点\n    let minDistance = Infinity;\n    ['left', 'right', 'top', 'bottom'].forEach(item => {\n      let targetX;\n      let targetY;\n      if (item === 'left') {\n        targetX = v.x;\n        targetY = v.y + v.height / 2;\n      } else if (item === 'right') {\n        targetX = v.x + v.width;\n        targetY = v.y + v.height / 2;\n      } else if (item === 'top') {\n        targetX = v.x + v.width / 2;\n        targetY = v.y;\n      } else if (item === 'bottom') {\n        targetX = v.x + v.width / 2;\n        targetY = v.y + v.height;\n      }\n\n      minDistance = distance(\n        {\n          x: point.x,\n          y: point.y\n        },\n        {\n          x: targetX,\n          y: targetY\n        }\n      );\n\n      if (minDis > minDistance) {\n        minDis = minDistance;\n        targetNode = v;\n        targetPos = item;\n      }\n    });\n  });\n\n  if (minDis <= range) {\n    return { targetNode, targetPos };\n  }\n  return null;\n};\n","/**\n * @file demo公共方法\n * @author perkinJ\n */\n\n/**\n * 全屏某一个元素\n * @param element\n */\nfunction launchFullscreen(element: any) {\n  if (element.requestFullscreen) {\n    element.requestFullscreen();\n  } else if (element.mozRequestFullScreen) {\n    element.mozRequestFullScreen();\n  } else if (element.msRequestFullscreen) {\n    element.msRequestFullscreen();\n  } else if (element.webkitRequestFullscreen) {\n    element.webkitRequestFullscreen();\n  }\n}\n/**\n * 退出全屏\n */\nfunction exitFullscreen() {\n  if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if (document.exitFullscreen) {\n    document.exitFullscreen();\n  } else if ((document as any).webkitExitFullscreen) {\n    (document as any).webkitExitFullscreen();\n  }\n}\n\n/**\n * 判断是否处于全屏状态\n */\nfunction isFull() {\n  const doc = document as any;\n  return doc.fullscreenElement || doc.webkitFullscreenElement;\n}\n\n/**\n * 获取元素相对于页面的绝对位置\n */\nfunction getOffset(domNode: any) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n  let targetDomNode = domNode;\n  while (targetDomNode !== window.document.body && targetDomNode != null) {\n    offsetLeft = offsetLeft + targetDomNode.offsetLeft;\n    offsetTop = offsetTop + targetDomNode.offsetTop;\n    targetDomNode = targetDomNode.offsetParent;\n  }\n  return {\n    offsetTop,\n    offsetLeft\n  };\n}\n\nexport { launchFullscreen, exitFullscreen, isFull, getOffset };\n","/**\n * @file 处理画布内的操作\n */\n\nimport * as React from \"react\";\nimport * as _ from \"lodash\";\nimport * as uuid from \"uuid\";\nimport { ReScreen, Utils } from \"regraph-next\";\nimport { ZoomTransform, zoomIdentity } from \"d3-zoom\";\nimport { Menu } from \"antd\";\nimport { EditorNode } from \"./EditorNode\";\nimport { EditorEdges } from \"./EditorEdges\";\nimport { ContextMenu } from \"./ContextMenu\";\nimport {\n  MenuPos,\n  CONNECTOR,\n  OperateType,\n  Link,\n  Node,\n  NODE_WIDTH,\n  NODE_HEIGHT,\n  LINK_AREA\n} from \"./defines\";\nimport {\n  findUpstreamNode,\n  findAllUpstreamNodes,\n  findDownstreamNode,\n  findAllDownstreamNodes,\n  findAllDownstreamLinks,\n  findNearbyNode\n} from \"./utils/find\";\nimport { calcLinkPosition } from \"./utils/calc\";\nimport { exitFullscreen, launchFullscreen, isFull, getOffset } from \"../utils\";\n\nconst { Point } = Utils;\n\nclass CanvasContentProps {\n  ref: any;\n  nodes: Node[];\n  links: Link[];\n  setNodes: (nodes: Node[]) => void;\n  setLinks: (links: Link[]) => void;\n  selectedLinks: string[];\n  setSelectedLinks: (links: string[]) => void;\n  selectedNodes: string[];\n  setSelectedNodes: (links: string[]) => void;\n  /** 当前拖拽的节点 */\n  dragNode: Node;\n  updateNodes: (node: Node) => void;\n  updateLinks: (link: Link) => void;\n  deleteNodes: (selectedNodes: string[]) => void;\n  deleteLinks: (selectedLinks: string[]) => void;\n  copiedNodes: Node[];\n  setCopiedNodes: (nodes: Node[]) => void;\n  currTrans: ZoomTransform;\n  setCurrTrans:(transform: ZoomTransform) => void;\n}\n\nclass CanvasContentState {\n  /** 拖拽节点 */\n  isDraggingNode: boolean;\n  /** 拖拽边 */\n  isDraggingLink: boolean;\n  /** 拖拽节点 */\n  dragNode: Node;\n  /** 鼠标位置在拖动节点的偏移量 */\n  dragNodeOffset: any;\n  /** 移动边 */\n  dragLink: {\n    /** 源起节点id */\n    originId: string;\n    /** 源起节点 */\n    originX: number;\n    originY: number;\n    /** 鼠标移动节点 */\n    x: number;\n    y: number;\n    /** 来源边位置 */\n  };\n  sourcePos: string;\n  /** 对话框展示标志位 */\n  menuDisplay: boolean;\n  /** 对话框的位置信息 */\n  menuPos: MenuPos;\n  /** 画布的放大倍率 */\n  screenScale: number;\n  isKeyPressing: boolean;\n  /** 当前鼠标悬浮的节点 */\n  currentHoverNode: string;\n  /** 删除框 */\n  deleteVisible: boolean;\n}\n\nexport default class CanvasContent extends React.Component<\n  CanvasContentProps,\n  CanvasContentState\n> {\n  nodesContainerRef: any;\n  container: any;\n  screenWidth: number;\n  screenHeight: number;\n\n  autoVerticalScroller: any = null;\n  autoHorizontalScroller: any = null;\n\n  handleResize: (isLarge: boolean) => void;\n  handleAdapt: () => void;\n  handleResizeTo: (scale: number, P0?: [number, number]) => void;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isDraggingNode: false,\n      isDraggingLink: false,\n      isKeyPressing: false,\n      dragNode: null,\n      dragLink: null,\n      dragNodeOffset: null,\n      menuDisplay: false,\n      menuPos: {\n        id: \"\",\n        x: 0,\n        y: 0\n      },\n      screenScale: 100,\n      sourcePos: \"\",\n      currentHoverNode: \"\",\n      deleteVisible: false\n    };\n    this.nodesContainerRef = React.createRef();\n    this.container = React.createRef();\n    // this.props.currTrans = zoomIdentity;\n\n  }\n\n  componentDidMount() {\n    this.nodesContainerRef.current.addEventListener(\n      \"mousedown\",\n      this.onNodesContainerMouseDown\n    );\n    this.container.current.addEventListener(\n      \"contextmenu\",\n      this.openContainerMenu\n    );\n    this.container.current.addEventListener(\"click\", this.onContainerMouseDown);\n  }\n\n  componentWillUnmount() {\n    this.nodesContainerRef.current.removeEventListener(\n      \"mousedown\",\n      this.onNodesContainerMouseDown\n    );\n    this.container.current.removeEventListener(\n      \"contextmenu\",\n      this.openContainerMenu\n    );\n    this.container.current.removeEventListener(\n      \"click\",\n      this.onContainerMouseDown\n    );\n  }\n\n  componentWillUpdate(\n    nextProps: CanvasContentProps,\n    nextState: CanvasContentState\n  ) {\n    if (this.state.isDraggingNode !== nextState.isDraggingNode) {\n      this.toggleDragNode(nextState.isDraggingNode);\n    }\n    if (this.state.isDraggingLink !== nextState.isDraggingLink) {\n      this.toggleDragLink(nextState.isDraggingLink);\n    }\n  }\n\n  /** 打开全局操作菜单，包括复制，粘贴，删除等 */\n  openContainerMenu = (event: any) => {\n    event.preventDefault();\n  };\n\n  toggleDragNode = (isDraggingNode: Boolean) => {\n    if (isDraggingNode) {\n      window.addEventListener(\"mousemove\", this.onDragNodeMouseMove);\n      window.addEventListener(\"mouseup\", this.onDragNodeMouseUp);\n    } else {\n      window.removeEventListener(\"mousemove\", this.onDragNodeMouseMove);\n      window.removeEventListener(\"mouseup\", this.onDragNodeMouseUp);\n    }\n  };\n\n  toggleDragLink = (isDraggingLink: Boolean) => {\n    if (isDraggingLink) {\n      window.addEventListener(\"mousemove\", this.onDragLinkMouseMove);\n      window.addEventListener(\"mouseup\", this.onDragLinkMouseUp);\n    } else {\n      window.removeEventListener(\"mousemove\", this.onDragLinkMouseMove);\n      window.removeEventListener(\"mouseup\", this.onDragLinkMouseUp);\n    }\n  };\n\n  onDragLinkMouseMove = (event: any) => {\n    event.stopPropagation();\n    event.preventDefault();\n\n    const { offsetTop, offsetLeft } = getOffset(this.container.current);\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    const { k, x, y } = this.props.currTrans;\n\n    this.setState(preState => {\n      const { dragLink } = preState;\n      return {\n        dragLink: {\n          ...dragLink,\n          x: (screenX - x) / k,\n          y: (screenY - y) / k\n        }\n      };\n    });\n  };\n\n  /** 监听整个区域，提升性能 */\n  onNodesContainerMouseDown = (event: any) => {\n    event.stopPropagation();\n    const { nodes } = this.props;\n    if (nodes && nodes.length > 0) {\n      const component = _.find(nodes, c => {\n        if (c.ref && c.ref.current) {\n          return c.ref.current.contains(event.target);\n        }\n        return false;\n      });\n\n      const type = event.target.dataset && event.target.dataset.type;\n      const position = event.target.dataset && event.target.dataset.position;\n\n      if (component) {\n        if (type === \"edge\" && position) {\n          /** 拖拽连线 */\n          this.onDragLinkMouseDown(component as any, position);\n          return;\n        } else if (type === \"resize\") {\n          return;\n        } else {\n          /** 拖拽节点，排除resize节点 */\n          this.onDragNodeMouseDown(component as any, event);\n        }\n      }\n    }\n  };\n\n  /** 监听整个容器click事件 */\n  onContainerMouseDown = (event: any) => {\n    // event.stopPropagation();\n\n    // 过滤掉节点和边\n    const path = event.path;\n    const isNodeOrLink = this.hasNodeOrLink(path, \"editor-node\", \"editor-link\");\n    if (!isNodeOrLink) {\n      // 清空高亮的节点和边\n      this.handleClearActive();\n    }\n  };\n\n  /** 监听整个容器mousemove 事件 */\n  onNodesContainerMouseMove = (event: any) => {\n    event.preventDefault();\n    const path = event.path;\n    const isNodeOrLink = this.hasNodeOrLink(path, \"editor-node\", \"editor-link\");\n    const { nodes } = this.props;\n\n    if (nodes && nodes.length > 0) {\n      const currentNode = _.find(nodes, c => {\n        if (c.ref && c.ref.current) {\n          return c.ref.current.contains(event.target);\n        }\n        return false;\n      }) as Node;\n\n      if (currentNode) {\n        if (isNodeOrLink) {\n          this.setState({\n            currentHoverNode: currentNode.id\n          });\n        } else {\n          this.setState({\n            currentHoverNode: \"\"\n          });\n        }\n      }\n    }\n  };\n\n  /** 按下节点 */\n  onDragNodeMouseDown = (node: Node, event: any) => {\n    const { k, x, y } = this.props.currTrans;\n\n    const { offsetTop, offsetLeft } = getOffset(this.container.current);\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    this.setState(preState => {\n      // 计算鼠标位置在节点中的偏移量\n      return {\n        isDraggingNode: true,\n        dragNode: node,\n        dragNodeOffset: {\n          x: (screenX - x) / k - node.x,\n          y: (screenY - y) / k - node.y\n        }\n      };\n    });\n  };\n\n  /** 鼠标按下，进行连线 */\n  onDragLinkMouseDown = (node: Node, position: string) => {\n    const { x, y } = calcLinkPosition(node, position);\n    this.setState({\n      isDraggingLink: true,\n      dragLink: {\n        originId: node.id,\n        originX: x,\n        originY: y,\n        x,\n        y\n      },\n      sourcePos: position\n    });\n  };\n\n  /** 鼠标抬起，连线结束 */\n  onDragLinkMouseUp = (event: any) => {\n    const { setLinks, links, nodes } = this.props;\n    const { dragLink } = this.state;\n    const { offsetTop, offsetLeft } = getOffset(this.container.current);\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    const { k, x, y } = this.props.currTrans;\n\n    const nearNode = findNearbyNode(\n      {\n        x: (screenX - x) / k,\n        y: (screenY - y) / k\n      },\n      nodes,\n      LINK_AREA\n    );\n\n    // 需要找到链接的是哪个节点\n\n    if (nearNode) {\n      const { targetNode, targetPos } = nearNode;\n      const newLink = {\n        id:\n          dragLink.originId + CONNECTOR + targetNode.id + CONNECTOR + targetPos,\n        source: dragLink.originId,\n        target: targetNode.id,\n        sourcePos: this.state.sourcePos,\n        targetPos\n      };\n      setLinks([...links, newLink]);\n    }\n\n    this.setState({\n      isDraggingLink: false,\n      dragLink: null,\n      sourcePos: \"\"\n    });\n  };\n\n  /** 移动节点 */\n  onDragNodeMouseMove = (event: any) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const { setNodes, nodes } = this.props;\n\n    const { k, x, y } = this.props.currTrans;\n\n    const { offsetTop, offsetLeft } = getOffset(this.container.current);\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    // 判断当前节点平移后是否溢出画布\n    // const isOver = this.checkNodeIsOverScreen(dragNode, screenX, screenY);\n\n    // if (!isOver) {\n    this.setState(preState => {\n      const { dragNode, dragNodeOffset } = preState;\n\n      const newX = (screenX - x) / k - dragNodeOffset.x;\n      const newY = (screenY - y) / k - dragNodeOffset.y;\n\n      return {\n        ...preState,\n        dragNode: {\n          ...dragNode,\n          x: newX,\n          y: newY\n        }\n      };\n    });\n\n    const { dragNodeOffset, dragNode } = this.state;\n\n    setNodes(\n      nodes.map(c => {\n        return c.id === dragNode.id\n          ? {\n              ...c,\n              x: (screenX - x) / k - dragNodeOffset.x,\n              y: (screenY - y) / k - dragNodeOffset.y\n            }\n          : c;\n      })\n    );\n  };\n\n  /** 放开节点 */\n  onDragNodeMouseUp = (event: any) => {\n    event.stopPropagation();\n    // this.moveStop(true);\n    // this.moveStop(false);\n\n    this.setState(preState => {\n      const { dragNode } = preState;\n\n      return {\n        ...preState\n      };\n    });\n    this.setState({\n      isDraggingNode: false\n    });\n  };\n\n  getTransformInfo = (currTrans: ZoomTransform) => {\n    this.props.setCurrTrans(currTrans);\n  };\n\n  getScreenHandler = handleMap => {\n    // this.handleApplyTransform = handleMap.handleApplyTransform;\n    this.handleResize = handleMap.handleResize;\n    this.handleResizeTo = handleMap.handleResizeTo;\n    this.handleAdapt = handleMap.handleAdapt;\n    this.screenWidth = handleMap.screenWidth;\n    this.screenHeight = handleMap.screenHeight;\n  };\n\n  onDrag(event, name: string) {}\n\n  onDrop(event: React.DragEvent<HTMLDivElement>) {\n    const { setNodes, nodes, dragNode } = this.props;\n    const { offsetTop, offsetLeft } = getOffset(this.container.current);\n    const screenX = event.clientX - offsetLeft;\n    const screenY = event.clientY - offsetTop;\n\n    const { k, x, y } = this.props.currTrans;\n\n    if (dragNode) {\n      const { key, name, type, width, height } = dragNode;\n\n      const newNode = {\n        key,\n        name,\n        type,\n        width,\n        height,\n        x: (screenX - x) / k - NODE_WIDTH / 2,\n        y: (screenY - y) / k - NODE_HEIGHT / 2,\n        id: uuid.v4(),\n        ref: React.createRef()\n      };\n\n      setNodes([...nodes, newNode]);\n    }\n  }\n\n\n  /** 清空高亮组件和连线 */\n  handleClearActive = () => {\n    this.props.setSelectedLinks([]);\n    this.props.setSelectedNodes([]);\n  };\n\n  /** 判断点击的节点是否为节点和边 */\n  hasNodeOrLink = (array: any[], node?: string, link?: string) => {\n    let isNodeOrLink = false;\n\n    for (let i = 0; i < array.length; i++) {\n      const inNode = _.includes(array[i].classList, node);\n      const inLink = _.includes(array[i].classList, link);\n\n      if (inNode || inLink) {\n        isNodeOrLink = true;\n        break;\n      }\n    }\n    return isNodeOrLink;\n  };\n\n  /** 改变缩放倍率 */\n  changeScreenScale = (screenScale: number) => {\n    this.setState({\n      screenScale\n    });\n  };\n\n  /** 处理全屏事件 */\n  handleFullScreen = () => {\n    const fullScreen = isFull();\n    if (fullScreen) {\n      exitFullscreen();\n    } else {\n      launchFullscreen(this.container.current);\n    }\n  };\n\n  renderDragSource() {\n    const dragSourceList = [\"组件1\", \"组件2\"];\n\n    return (\n      <div className=\"flow-drag-source\">\n        {dragSourceList.map((name, index) => {\n          return (\n            <div\n              className=\"flow-drag-source-item\"\n              key={index}\n              draggable\n              onDrag={event => this.onDrag(event, name)}\n            >\n              {name}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  /** 点击连线 */\n  onSelectLink = (key: string) => {\n    const { selectedLinks, setSelectedLinks } = this.props;\n    if (selectedLinks) {\n      // 若连线已高线，则取消高亮状态\n      const index = _.findIndex(selectedLinks, link => link === key);\n      if (index > -1) {\n        setSelectedLinks([\n          ...selectedLinks.slice(0, index),\n          ...selectedLinks.slice(index + 1)\n        ]);\n      } else {\n        setSelectedLinks([...selectedLinks, key]);\n      }\n    } else {\n      setSelectedLinks([key]);\n    }\n  };\n\n  /** 点击节点 */\n  onClickNode = (currentNode: Node) => {\n    const { selectedNodes, setSelectedNodes } = this.props;\n    const { isKeyPressing } = this.state;\n    // 区分多选按钮是否按下\n    if (isKeyPressing) {\n      if (selectedNodes) {\n        // 若节点已被点击则清除点击状态\n        const index = _.findIndex(selectedNodes, id => id === currentNode.id);\n        if (index > -1) {\n          setSelectedNodes([\n            ...selectedNodes.slice(0, index),\n            ...selectedNodes.slice(index + 1)\n          ]);\n        } else {\n          setSelectedNodes(_.compact([...selectedNodes, currentNode.id]));\n        }\n      } else {\n        setSelectedNodes([currentNode.id]);\n      }\n    } else {\n      this.props.setSelectedNodes([currentNode.id]);\n      // 清空高亮的连线\n      this.props.setSelectedLinks(null);\n    }\n  };\n\n  /** 被连线的节点 */\n  onSelectNode = (currentNode: Node, key: OperateType) => {\n    const { selectedNodes, deleteNodes } = this.props;\n    if (key === OperateType.delete) {\n      // 删除组件以及删除连线\n      // 判断改节点是否在多选区域内\n      if (selectedNodes && selectedNodes.includes(currentNode.id)) {\n        deleteNodes(_.compact([...selectedNodes, currentNode.id]));\n      } else {\n        deleteNodes([currentNode.id]);\n      }\n    }\n  };\n\n  /** 右键连线 */\n  onContextMenuLink = (\n    key: string,\n    event: React.MouseEvent<SVGPathElement, MouseEvent>\n  ) => {\n    event.preventDefault();\n    event.stopPropagation();\n    this.props.setSelectedLinks([key]);\n    // 清空高亮的组件\n    this.props.setSelectedNodes(null);\n\n    const currentPos = {\n      x: event.clientX,\n      y: event.clientY\n    };\n    this.setState({\n      deleteVisible: true,\n      menuPos: currentPos\n    });\n  };\n\n  /** 伸缩节点 */\n  onResize = (\n    node: Node,\n    width: number,\n    height: number,\n    x: number,\n    y: number\n  ) => {\n    const { updateNodes } = this.props;\n    const newNode = {\n      ...node,\n      width,\n      height,\n      x,\n      y\n    };\n    updateNodes(newNode);\n  };\n\n  renderCanvas = () => {\n    const { currentHoverNode } = this.state;\n    const { nodes, links, selectedNodes, selectedLinks } = this.props;\n    return (\n      <div className=\"editor-view\">\n        <div className=\"editor-view-content\" ref={this.nodesContainerRef}>\n          {nodes.map(child => {\n            const id = child.id;\n            const isSelected = selectedNodes\n              ? selectedNodes.includes(id)\n              : false;\n            const showSelector = isSelected || currentHoverNode === id;\n            return (\n              <EditorNode\n                nodeRef={child.ref}\n                currentNode={child}\n                key={id}\n                onClick={this.onClickNode}\n                isSelected={isSelected}\n                showSelector={showSelector}\n                onResize={this.onResize.bind(this, child)}\n                currTrans={this.props.currTrans}\n                onSelect={this.onSelectNode}\n              />\n            );\n          })}\n          <EditorEdges\n            links={links}\n            nodes={nodes}\n            selectedLinks={selectedLinks}\n            onContextMenu={this.onContextMenuLink}\n            onSelectLink={this.onSelectLink}\n            isDraggingLink={this.state.isDraggingLink}\n            dragLink={this.state.dragLink}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  render() {\n    const { deleteVisible, menuPos } = this.state;\n    return (\n      <div className=\"canvas-container-content\" ref={this.container}>\n        <ReScreen\n          type=\"DOM\"\n          getScreenHandler={this.getScreenHandler}\n          needMinimap={true}\n          needRefresh={true}\n          zoomEnabled={false}\n          mapPosition=\"RT-IN\"\n          mapWidth={200}\n          mapHeight={300}\n          mapRectStyle={{\n            stroke: '#468CFF',\n            fill: 'transparent',\n            strokeWidth: 1.5\n          }}\n          focusEnabled={2}\n          onScreenChange={this.getTransformInfo}\n          onDragOver={event => {\n            event.preventDefault();\n          }}\n          onDrop={this.onDrop.bind(this)}\n        >\n          {this.renderCanvas()}\n        </ReScreen>\n        {/** 删除连线的菜单 */}\n        <ContextMenu\n          visible={deleteVisible}\n          // onHide={() => {\n          //   this.props.setLinks(null);\n          //   this.setState({\n          //     deleteVisible: false\n          //   });\n          // }}\n          left={menuPos.x}\n          top={menuPos.y}\n          // onClick={this.handleDeleteLinks.bind(this, selectedLinks)}\n        >\n          <Menu\n            getPopupContainer={(triggerNode: any) => triggerNode.parentNode}\n          >\n            {[\n              {\n                name: \"删除\",\n                key: OperateType.delete\n              }\n            ].map(child => {\n              return <Menu.Item key={child.key}>{child.name}</Menu.Item>;\n            })}\n          </Menu>\n        </ContextMenu>\n      </div>\n    );\n  }\n}\n","export const mockData = {\n  /**\n   * 主键ID\n   */\n  id: \"111\",\n  /**\n   * 管道名称/管道文件名\n   */\n\n  name: \"测试管道数据\",\n  /**\n   * 管道ID/管道文件ID\n   */\n\n  fileId: \"sdhsd\",\n\n  /**\n   * 租户ID\n   */\n  tenantId: \"168208\",\n  /**\n   * 项目ID\n   */\n\n  projectId: \"9987\",\n  /**\n   * 用户ID\n   */\n  userId: \"168208\",\n  /**\n   * 节点onwer\n   */\n  owner: \"perkinJ\",\n  /**\n   * owner展示名\n   */\n  ownerName: \"perkinJ\",\n  /**\n   * 节点创建时间\n   */\n  createTime: \"2019-12-10\",\n\n  /**\n   * 节点的最后修改者(id)\n   */\n  lastModifier: \"168208\",\n  /**\n   * 修改者展示名\n   */\n  lastModifierName: \"perkinJ\",\n  /**\n   * 最后修改时间\n   */\n  lastModifyTime: \"2019-12-10\",\n\n  /**\n   * 节点的调度配置,复用已存在的功能\n   */\n  nodeConfig: {\n    /**\n     * 节点id\n     */\n    nodeId: \"n_123\",\n    /**\n     * 节点名称\n     */\n    nodeName: \"节点名称\",\n\n    nodeOutputNameList: [\"Data_distill.id_mapping_dy_1\"],\n\n    nodeDesc: \"test\",\n    nodeType: 30,\n    operatorType: 30,\n    cronExpression: \"0 1 0 * * ?\",\n    nodeContent:\n      \"create table if not exists id_mapping_dy_1 (↵    key_type string,↵    key_id string, ↵    oneid string↵) partitioned by (ds string);\",\n    remark: \"test\",\n    params: null,\n    /**\n     * 数据源配置\n     */\n    dsConfig: { dsId: \"120104\" },\n    /**\n     * 所属的dagId\n     */\n    dagId: \"d_767389365932195840\",\n    /**\n     * 是否可以重跑\n     */\n    rerunable: null,\n    /**\n     * 有效时间区间\n     */\n    validPeriod: null,\n    /**\n     * 优先级, 1-最高, 数字越大优先级越低\n     * 是{@link Priority}的code\n     */\n    priority: null,\n    /**\n     * 节点状态, 1-正常,2-暂停,3-空跑\n     * 是{@link NodeStatusEnum}的code\n     */\n    nodeStatus: 1,\n    /**\n     * 是否是暂停状态\n     */\n    paused: null,\n    /**\n     * 上游依赖\n     * 注意这里的上游依赖{@link NodeRelation}只需要写sourceNodeOutputName和具体的依赖关系(如跨周期/跨天等)即可\n     */\n    upstreams: [\n      {\n        dayDiff: null,\n        periodDiff: 0,\n        sourceNodeId: \"n_767389365932195841\",\n        sourceNodeOutputName: \"virtual_root_node_767389365932195840\",\n        targetNodeId: null,\n        targetNodeOutputName: null\n      }\n    ],\n    /**\n     * 标识节点是由某个组织或应用创建的\n     */\n    nodeFrom: null,\n    nodeOwner: \"168208\",\n    /**\n     * 节点的标签信息\n     * 建议格式A: tagName=tagValue, tagName_2=tagValue_2\n     * 建议格式B: tag1, tag2\n     *\n     * @since v2.5.x\n     */\n    tags: []\n  },\n  faultTolerantConfig: {\n    errorCount: 10,\n    errorRate: 0.3,\n    readCount: 20\n  },\n  hops: [\n    {\n      id:\n        \"80bebab7-307a-4bf8-9545-c17e086a897e_05d35f38-8df0-4c5c-a917-036ef0bfca65\",\n      source: \"80bebab7-307a-4bf8-9545-c17e086a897e\",\n      target: \"05d35f38-8df0-4c5c-a917-036ef0bfca65\",\n      sourcePos: \"right\",\n      targetPos: \"top\"\n    }\n    // {\n    //   id: '80bebab7-307a-4bf8-9545-c17e086a897e_9d421eeb-84d6-4069-b42b-ce878e7b8efd',\n    //   source: '80bebab7-307a-4bf8-9545-c17e086a897e',\n    //   target: '9d421eeb-84d6-4069-b42b-ce878e7b8efd',\n    //   sourcePos: 'left',\n    //   targetPos: 'bottom'\n    // }\n  ],\n  steps: [\n    {\n      id: \"80bebab7-307a-4bf8-9545-c17e086a897e\",\n      key: \"rect\",\n      type: \"common\",\n      name: \"测试组件\",\n      x: 241,\n      y: 95,\n      width: 100,\n      height: 100,\n      distribute: true,\n      parallel: 2\n    },\n    {\n      id: \"05d35f38-8df0-4c5c-a917-036ef0bfca65\",\n      key: \"circle\",\n      name: \"MySQL_1\",\n      type: \"common\",\n      width: 250,\n      height: 100,\n      x: 449,\n      y: 259\n    }\n  ]\n};\n","import * as React from \"react\";\nimport * as _ from \"lodash\";\nimport { Node, Link } from \"../defines\";\nimport { ZoomTransform, zoomIdentity } from \"d3-zoom\";\nimport { mockData } from \"../mock\";\n\nconst { useState, useEffect } = React;\n\nexport function useEditorStore() {\n  const [editorData, setEditorData] = useState();\n  const [nodes, setNodes] = useState<Node[]>([]);\n  const [links, setLinks] = useState<Link[]>([]);\n  const [selectedLinks, setSelectedLinks] = useState<string[]>([]);\n  const [selectedNodes, setSelectedNodes] = useState<string[]>([]);\n  const [dragNode, setDragNode] = useState(null);\n\n  const [currTrans, setCurrTrans] = useState<ZoomTransform>(zoomIdentity);\n\n  const [copiedNodes, setCopiedNodes] = useState<Node[]>([]);\n\n  useEffect(() => {\n    setEditorData(mockData);\n\n    const newNodes = _.get(mockData, \"steps\").map(item => {\n      return {\n        ...item,\n        ref: React.createRef()\n      };\n    });\n    setNodes(newNodes);\n    setLinks(_.get(mockData, \"hops\"));\n  }, []);\n\n  const updateNodes = (node: Node) => {\n    const index = _.findIndex(nodes, item => item.id === node.id);\n\n    setNodes([...nodes.slice(0, index), node, ...nodes.slice(index + 1)]);\n  };\n\n  const updateLinks = (link: Link) => {\n    const index = _.findIndex(links, item => item.id === link.id);\n\n    setLinks([...links.slice(0, index), link, ...links.slice(index + 1)]);\n  };\n\n  return {\n    editorData,\n    setEditorData,\n    nodes,\n    setNodes,\n    links,\n    setLinks,\n    updateNodes,\n    updateLinks,\n    selectedLinks,\n    setSelectedLinks,\n    selectedNodes,\n    setSelectedNodes,\n    dragNode,\n    setDragNode,\n    copiedNodes,\n    setCopiedNodes,\n    currTrans,\n    setCurrTrans\n  };\n}\n","import { useEffect, useCallback, useRef, RefObject } from 'react';\n\nexport type KeyPredicate = (event: KeyboardEvent) => boolean;\nexport type keyType = KeyboardEvent['keyCode'] | KeyboardEvent['key'];\nexport type KeyFilter = keyType | Array<keyType> | ((event: KeyboardEvent) => boolean);\nexport type EventHandler = (event: KeyboardEvent) => void;\nexport type keyEvent = 'keydown' | 'keyup';\nexport type RefType = HTMLElement | (() => HTMLElement | null);\nexport type EventOption = {\n  events?: Array<keyEvent>;\n  target?: Window | RefType;\n};\n\n// 键盘事件 keyCode 别名\nconst aliasKeyCodeMap: any = {\n  esc: 27,\n  tab: 9,\n  enter: 13,\n  space: 32,\n  up: 38,\n  left: 37,\n  right: 39,\n  down: 40,\n  delete: [8, 46]\n};\n\n// 键盘事件 key 别名\nconst aliasKeyMap: any = {\n  esc: 'Escape',\n  tab: 'Tab',\n  enter: 'Enter',\n  space: ' ',\n  // IE11 uses key names without `Arrow` prefix for arrow keys.\n  up: ['Up', 'ArrowUp'],\n  left: ['Left', 'ArrowLeft'],\n  right: ['Right', 'ArrowRight'],\n  down: ['Down', 'ArrowDown'],\n  delete: ['Backspace', 'Delete']\n};\n\n// 修饰键\nconst modifierKey: any = {\n  ctrl: (event: KeyboardEvent) => event.ctrlKey,\n  shift: (event: KeyboardEvent) => event.shiftKey,\n  alt: (event: KeyboardEvent) => event.altKey,\n  meta: (event: KeyboardEvent) => event.metaKey\n};\n\n// 返回空对象\nconst noop = () => {};\n\n/**\n * 判断对象类型\n * @param [obj: any] 参数对象\n * @returns String\n */\nfunction isType(obj: any) {\n  return Object.prototype.toString\n    .call(obj)\n    .replace(/^\\[object (.+)\\]$/, '$1')\n    .toLowerCase();\n}\n\n/**\n * 判断按键是否激活\n * @param [event: KeyboardEvent]键盘事件\n * @param [keyFilter: any] 当前键\n * @returns Boolean\n */\nfunction genFilterKey(event: any, keyFilter: any) {\n  const type = isType(keyFilter);\n  // 数字类型直接匹配事件的 keyCode\n  if (type === 'number') {\n    return event.keyCode === keyFilter;\n  }\n  // 字符串依次判断是否有组合键\n  const genArr = keyFilter.split('.');\n  let genLen = 0;\n  for (const key of genArr) {\n    // 组合键\n    const genModifier = modifierKey[key];\n    // key 别名\n    const aliasKey = aliasKeyMap[key];\n    // keyCode 别名\n    const aliasKeyCode = aliasKeyCodeMap[key];\n    /**\n     * 满足以上规则\n     * 1. 自定义组合键别名\n     * 2. 自定义 key 别名\n     * 3. 自定义 keyCode 别名\n     * 4. 匹配 key 或 keyCode\n     */\n    if (\n      (genModifier && genModifier(event)) ||\n      (aliasKey && isType(aliasKey) === 'array' ? aliasKey.includes(event.key) : aliasKey === event.key) ||\n      (aliasKeyCode && isType(aliasKeyCode) === 'array'\n        ? aliasKeyCode.includes(event.keyCode)\n        : aliasKeyCode === event.keyCode) ||\n      event.key.toUpperCase() === key.toUpperCase()\n    ) {\n      genLen++;\n    }\n  }\n  return genLen === genArr.length;\n}\n\n/**\n * 键盘输入预处理方法\n * @param [keyFilter: any] 当前键\n * @returns () => Boolean\n */\nfunction genKeyFormater(keyFilter: any): KeyPredicate {\n  const type = isType(keyFilter);\n  if (type === 'function') {\n    return keyFilter;\n  }\n  if (type === 'string' || type === 'number') {\n    return (event: KeyboardEvent) => genFilterKey(event, keyFilter);\n  }\n  if (type === 'array') {\n    return (event: KeyboardEvent) => keyFilter.some((item: any) => genFilterKey(event, item));\n  }\n  return keyFilter ? () => true : () => false;\n}\n\nconst defaultEvents: Array<keyEvent> = ['keydown'];\n\nfunction useKeyPress<T extends HTMLElement = HTMLInputElement>(\n  keyFilter: KeyFilter,\n  eventHandler: EventHandler = noop,\n  option: EventOption = {}\n): RefObject<T> {\n  const { events = defaultEvents, target } = option;\n  const element = useRef<T>();\n  const callbackRef = useRef(eventHandler);\n  callbackRef.current = eventHandler;\n\n  const callbackHandler = useCallback(\n    event => {\n      const genGuard: KeyPredicate = genKeyFormater(keyFilter);\n      if (genGuard(event)) {\n        return callbackRef.current(event);\n      }\n    },\n    [keyFilter]\n  );\n\n  useEffect(() => {\n    const targetElement = typeof target === 'function' ? target() : target;\n    const el = element.current || targetElement || window;\n    for (const eventName of events) {\n      el.addEventListener(eventName, callbackHandler);\n    }\n    return () => {\n      for (const eventName of events) {\n        el.removeEventListener(eventName, callbackHandler);\n      }\n    };\n  }, [events, callbackHandler, target]);\n\n  return element as RefObject<T>;\n}\n\nexport { useKeyPress };\n","import * as React from \"react\";\nimport * as _ from \"lodash\";\nimport * as uuid from \"uuid\";\nimport { Toolbar, NodePanel, DragSelector } from \"./components\";\nimport CanvasContent from \"./CanvasContent\";\nimport { useEditorStore } from \"./hooks/useEditorStore\";\nimport { useKeyPress } from \"./hooks/useKeyPress\";\nimport { ShapeProps } from \"./utils/useDragSelect\";\nimport { pointInPoly } from \"./utils/layout\";\n\nimport \"./index.scss\";\n\nconst { useState, useRef, useEffect } = React;\n\nexport default function EditorDemo(props) {\n  const [screenScale, changeScreenScale] = useState(100);\n  const [dragSelectable, setDragSelectable] = useState(false);\n  const {\n    nodes,\n    links,\n    setNodes,\n    setLinks,\n    selectedLinks,\n    setSelectedLinks,\n    dragNode,\n    setDragNode,\n    selectedNodes,\n    setSelectedNodes,\n    updateNodes,\n    updateLinks,\n    copiedNodes,\n    setCopiedNodes,\n    currTrans,\n    setCurrTrans\n  } = useEditorStore();\n\n  // 画布容器\n  const screenRef = useRef(null);\n\n  // 画布 ref\n  const canvasRef = useRef({\n    getWrappedInstance: () => Object\n  } as any);\n\n  const canvasInstance = canvasRef.current;\n\n  // 更新画布容器的高度\n  const canvasContainer = document.querySelector(\".editor-canvas\");\n\n  /** 删除组件 */\n  const handleDeleteNodes = (ids: string[]) => {\n    if (!ids) {\n      return;\n    }\n    // 删除与组件相连的连线，不论上游或下游\n\n    const newLinks = _.cloneDeep(links);\n    ids.forEach(id => {\n      // 删除与节点连接的任意边\n      _.remove(newLinks, link => link.source === id || link.target === id);\n    });\n    // 更新连线\n    setLinks(newLinks);\n\n    // 剔除components\n    const cloneNodes = _.cloneDeep(nodes);\n    const newNodes = _.remove(cloneNodes, item => !ids.includes(item.id));\n\n    setNodes(newNodes);\n\n    // 清空高亮状态\n    setSelectedLinks([]);\n    setSelectedNodes([]);\n  };\n\n  /** 删除连线 */\n  const handleDeleteLinks = (activeLinks: string[]) => {\n    if (!activeLinks) {\n      return;\n    }\n    const linkList = links.map(link => link.id);\n    const diffLinks = _.difference(linkList, activeLinks);\n    const newLinks = diffLinks\n      ? diffLinks.map(link => _.find(links, item => item.id === link))\n      : [];\n    setLinks(newLinks);\n  };\n\n  /** 复制节点 */\n  const handleNodesCopy = (ids: string[]) => {\n    const newCopiedNodes = ids.map(id => {\n      return _.find(nodes, item => item.id === id);\n    });\n\n    setCopiedNodes(newCopiedNodes);\n  };\n\n  /** 粘贴节点 */\n  const handleNodesPaste = () => {\n    if (copiedNodes) {\n      const currentCopied = copiedNodes.map(node => {\n        return {\n          ...node,\n          id: uuid.v4(),\n          /**  @todo 后续可优化布局算法 */\n          x: node.x + node.width + 20,\n          ref: React.createRef()\n        };\n      });\n      setCopiedNodes(currentCopied);\n      setNodes([...nodes, ...currentCopied]);\n    }\n  };\n\n  // 剪切\n  const handleShear = () => {\n    if (selectedNodes) {\n      handleNodesCopy(selectedNodes);\n      handleDeleteNodes(selectedNodes);\n    }\n  };\n\n  // 复制\n  const handleCopy = () => {\n    if (selectedNodes) {\n      handleNodesCopy(selectedNodes);\n    }\n  };\n\n  // 粘贴\n  const handlePaste = () => {\n    if (copiedNodes) {\n      handleNodesPaste();\n    }\n  };\n\n  // 删除\n  const handleDelete = () => {\n    if (selectedNodes) {\n      handleDeleteNodes(selectedNodes);\n    }\n    if (selectedLinks) {\n      handleDeleteLinks(selectedLinks);\n    }\n  };\n\n  // 圈选\n  const handleDragSelect = () => {\n    setDragSelectable(!dragSelectable);\n  };\n\n  /** 处理DragSelector 关闭事件 */\n  const onDragSelectorClose = (selectorProps: ShapeProps) => {\n    // 计算区域内的位置有多少节点需要高亮,其实计算的是一个点是否在矩形内\n\n    // 1. 计算每个节点的中心\n    // 多边形的位置信息要与画布同步\n    const { k, x, y } = currTrans;\n\n    const points = nodes.map(node => {\n      return {\n        x: k * node.x + x + (node.width / 2) * k,\n        y: k * node.y + y + (node.height / 2) * k,\n        id: node.id\n      };\n    });\n\n    // 2. 多边形各个点转化为数组，暂时为矩形，后面考虑其他形状\n    let poly = [];\n    if (selectorProps.direction === \"left\") {\n      poly = [\n        { x: selectorProps.x, y: selectorProps.y },\n        { x: selectorProps.x + selectorProps.width, y: selectorProps.y },\n        {\n          x: selectorProps.x + selectorProps.width,\n          y: selectorProps.y + selectorProps.height\n        },\n        { x: selectorProps.x, y: selectorProps.y + selectorProps.height }\n      ];\n    } else {\n      poly = [\n        { x: selectorProps.x, y: selectorProps.y },\n        { x: selectorProps.x - selectorProps.width, y: selectorProps.y },\n        {\n          x: selectorProps.x - selectorProps.width,\n          y: selectorProps.y - selectorProps.height\n        },\n        { x: selectorProps.x, y: selectorProps.y - selectorProps.height }\n      ];\n    }\n\n    // 3. 射线法判断点是否在多边形的内部\n    const ids = points.map(point => {\n      if (pointInPoly(point, poly) === \"in\") {\n        return point.id;\n      }\n    });\n    setSelectedNodes(ids);\n    setDragSelectable(false);\n  };\n\n  useKeyPress(\n    \"delete\",\n    () => {\n      handleDelete();\n    },\n    {\n      events: [\"keydown\", \"keyup\"]\n    }\n  );\n\n  const isMac = navigator.platform.startsWith(\"Mac\");\n\n  useKeyPress(isMac ? [\"meta.x\"] : [\"ctrl.x\"], () => {\n    handleShear();\n  });\n\n  useKeyPress(isMac ? [\"meta.c\"] : [\"ctrl.c\"], () => {\n    handleCopy();\n  });\n\n  useKeyPress(isMac ? [\"meta.v\"] : [\"ctrl.v\"], () => {\n    handlePaste();\n  });\n\n  /** 操作区 */\n  const renderOperation = (\n    <div>\n      <Toolbar\n        ref={screenRef}\n        screenScale={screenScale}\n        changeScreenScale={changeScreenScale}\n        handleResizeTo={canvasInstance && canvasInstance.handleResizeTo}\n        items={[\n          \"fullscreen\",\n          \"zoom\",\n          \"adapt\",\n          \"format\",\n          \"ratio\",\n          \"shear\",\n          \"copy\",\n          \"paste\",\n          \"delete\",\n          \"dragSelect\"\n        ]}\n        layout={canvasInstance && canvasInstance.layout}\n        onCopy={handleCopy}\n        onPaste={handlePaste}\n        onDelete={handleDelete}\n        onShear={handleShear}\n        onDragSelect={handleDragSelect}\n      />\n    </div>\n  );\n  /** 渲染节点选择区 */\n  const renderNodePanel = (\n    <div className=\"editor-nodePanel\">\n      <NodePanel onDrag={setDragNode} />\n    </div>\n  );\n\n  /** 渲染中间画布区 */\n  const renderCanvas = (\n    <div className=\"editor-canvas\">\n      <DragSelector\n        visible={dragSelectable}\n        getPopupContainer={() => document.querySelector(\".editor-canvas\")}\n        overlayColor={\"rgba(0,0,0,0.1)\"}\n        selectorStyle={{\n          fill: \"transparent\",\n          strokeWidth: 1,\n          stroke: \"#6ca0f5\",\n          strokeDasharray: \"5 5\"\n        }}\n        onClose={onDragSelectorClose}\n      />\n      <CanvasContent\n        dragNode={dragNode}\n        ref={canvasRef}\n        nodes={nodes}\n        links={links}\n        setNodes={setNodes}\n        setLinks={setLinks}\n        selectedLinks={selectedLinks}\n        setSelectedLinks={setSelectedLinks}\n        selectedNodes={selectedNodes}\n        setSelectedNodes={setSelectedNodes}\n        updateNodes={updateNodes}\n        updateLinks={updateLinks}\n        deleteNodes={handleDeleteNodes}\n        deleteLinks={handleDeleteLinks}\n        copiedNodes={copiedNodes}\n        setCopiedNodes={setCopiedNodes}\n        currTrans={currTrans}\n        setCurrTrans={setCurrTrans}\n      />\n    </div>\n  );\n\n  /** 渲染配置区 */\n  const renderProperty = <div className=\"editor-property\"></div>;\n\n  return (\n    <div className=\"editor-demo\" ref={screenRef}>\n      <div className=\"editor-operation\">{renderOperation}</div>\n      <div className=\"editor-container\">\n        {renderNodePanel}\n        {renderCanvas}\n        {renderProperty}\n      </div>\n    </div>\n  );\n}\n","/**\n * @file 布局相关方法\n * @author perkinJ\n */\n\nexport class Point {\n  x: number;\n\n  y: number;\n}\n\nexport type Relation = 'on' | 'in' | 'out';\n\n/**\n * @description 射线法判断点是否在多边形内部\n * @param {Object} p 待判断的点，格式：{ x: X坐标, y: Y坐标 }\n * @param {Array} poly 多边形顶点，数组成员的格式同 p\n * @return {Relation} 点p在多边形的关系，分别为on,in,out\n */\n\nexport function pointInPoly(p: Point, poly: Point[]): Relation {\n  const px = p.x;\n  const py = p.y;\n  let flag = false;\n\n  for (let i = 0, l = poly.length, j = l - 1; i < l; j = i, i++) {\n    const sx = poly[i].x;\n    const sy = poly[i].y;\n    const tx = poly[j].x;\n    const ty = poly[j].y;\n\n    // 点与多边形顶点重合\n    if ((sx === px && sy === py) || (tx === px && ty === py)) {\n      return 'on';\n    }\n\n    // 判断线段两端点是否在射线两侧\n    if ((sy < py && ty >= py) || (sy >= py && ty < py)) {\n      // 线段上与射线 Y 坐标相同的点的 X 坐标\n      const x = sx + ((py - sy) * (tx - sx)) / (ty - sy);\n\n      // 点在多边形的边上\n      if (x === px) {\n        return 'on';\n      }\n\n      // 射线穿过多边形的边界\n      if (x > px) {\n        flag = !flag;\n      }\n    }\n  }\n\n  // 射线穿过多边形边界的次数为奇数时点在多边形内\n  return flag ? 'in' : 'out';\n}\n","import * as React from \"react\";\nimport { render } from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n","import * as React from \"react\";\nimport Editor from \"./editor\";\nimport \"./styles.css\";\n\nexport default function App() {\n  return (\n    <div className=\"App\">\n      <Editor />\n    </div>\n  );\n}\n"],"sourceRoot":""}